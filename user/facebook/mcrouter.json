{"_default": {"1": {"coooold": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/227", "title": "Which release is a stable version?", "body": "We're planning to use mcrouter for cross idc replicating? But i found there are hundreds of commit after release 0.36.  Should we take the head commit as the PRODUCTION one? or an elder release?\r\nAnd which commits of wangle and folly should we take? Thanks very much", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/227/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "kornrunner": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/225", "title": "Fix compile for boost 1.61+", "body": "Hi,\r\n\r\nI've submitted #224 that fixes compilation when boost is 1.61+, and keeps BC.\r\n\r\nAny interest in merging it in? Thanks!", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/225/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/facebook/mcrouter/pulls/224", "title": "fix boost_context when boost is 1.61+", "body": "", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "kelu27": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/223", "title": "Cannot bind to a specific address", "body": "Hi,\r\n\r\nIs it possible to have an option like ``` --address 127.0.0.1``` to bind on a specific address?\r\n\r\nThanks!", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/223/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "amcrn": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/222", "title": "Feature Request: Support GAT & GATS (Get And Touch Commands)", "body": "Memcached 1.5.3 added the `gat` and `gats` commands to the ASCII protocol.\r\n\r\nSee:\r\n\r\n* https://github.com/memcached/memcached/wiki/ReleaseNotes153\r\n* https://github.com/memcached/memcached/commit/7f4e0246e5c27baa9a7a690e5905f5ee56b80ece\r\n\r\nExample:\r\n\r\n```\r\nConnected to localhost.\r\nEscape character is '^]'.\r\nset foo 0 0 3\r\nbar\r\nSTORED\r\ngat 0 foo\r\nVALUE foo 0 3\r\nbar\r\nEND\r\ngats 0 foo\r\nVALUE foo 0 3 1\r\nbar\r\nEND\r\n```\r\n\r\nIt would be great to have support for these commands in mcrouter. As of now, these result in `CLIENT_ERROR malformed request` because they're not implemented.", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/222/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/189", "title": "Discussion - Gutter Is Stuck as \"Suspect\" Due to No Traffic", "body": "#### Summary\r\n\r\nIf a Gutter server is marked as suspect, and shortly thereafter the failover goes back to the main Pool Route, the Gutter server will remain as suspect until another failover occurs (which could be days or weeks/months) or mcrouter is restarted.\r\n\r\nDiscussion: We alert on non-empty `suspect_servers` that are sustained over multiple samples, so when we reach this state, we have to disable the alarm until we nuke/restart mcrouter. It _feels_ like a Server should be unmarked as suspect if it hasn't received any request/traffic after X elapsed time. I'm curious how Facebook handles this?\r\n\r\nOn a related note, the Gutter server's `avg_latency_us` is usually pretty bad in this case, which  heavily skews `duration_us` (making it very misleading) until another failover occurs or mcrouter is restarted. I'm curious how Facebook handles this because it makes `duration_us` for Gutter-enabled Clusters somewhat unreliable. I've pondered whether having an admin command that can flush/clear the stats is a good idea (e.g. `delete __mcrouter__.stats`); this would at least permit the administrator to clear when they deem appropriate. Thoughts?\r\n\r\nPossible Enhancements (All, Some, or None):\r\n\r\n* A Server is no longer marked as suspect if it hasn't received a request after X duration of time.\r\n* Support an admin mcrouter command that flushes/clears all mcrouter statistics.\r\n* Support a configuration value that let's the operator define a value other than 1 for the number of consecutive failures until a server is marked as suspect.\r\n  * See: https://github.com/facebook/mcrouter/blob/d1235676cb1141f0096e1d62f5bb3e78cbef6a44/mcrouter/TkoTracker.cpp#L213-L240.\r\n  * The provided value could be assumed to be a % of the failures_until_tko, or the validation could just ensure that the provided literal is less than failures_until_tko. This requires more thought.\r\n\r\n#### stats servers\r\n\r\n    STAT gutter1-a.west.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:20955.464 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:7 closed:1; notfound:14 timeout:35\r\n    STAT gutter2-b.east.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:3114.648 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:3 closed:5; notfound:176 stored:17\r\n    STAT gutter3-c.midw.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:17087.464 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:7 closed:1; notfound:11\r\n    STAT memcached1.west.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:15101.138 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:5 up:1 closed:2; deleted:89 notfound:3988 timeout:13\r\n    STAT memcached2.west.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:14974.834 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:5 up:1 closed:2; deleted:80 notfound:4029 timeout:20\r\n    STAT memcached3.west.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:15877.487 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:5 up:1 closed:2; deleted:93 notfound:3935 timeout:16\r\n    STAT memcached4.east.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:297.910 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:2 up:6; deleted:2290 found:4665005 notfound:778496 stored:776373 timeout:73\r\n    STAT memcached5.east.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:295.490 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:2 up:6; deleted:2280 found:4596041 notfound:779068 stored:776203 timeout:77\r\n    STAT memcached6.east.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:335.140 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:2 up:6; deleted:2260 found:4559366 notfound:778686 stored:776880 timeout:43\r\n    STAT memcached7.midw.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:10311.639 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:5 up:1 closed:2; deleted:99 notfound:3989 timeout:2\r\n    STAT memcached8.midw.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:9808.252 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:5 up:1 closed:2; deleted:90 notfound:4039\r\n    STAT memcached9.midw.example.com:11211:ascii:plain:notcompressed-20 avg_latency_us:10010.619 pending_reqs:0 inflight_reqs:0 avg_retrans_ratio:0 max_retrans_ratio:0 min_retrans_ratio:0 new:5 up:1 closed:2; deleted:95 notfound:3940 timeout:9\r\n    END\r\n\r\n#### stats suspect_servers\r\n\r\n    STAT gutter1-a.west.example.com:11211 status:down num_failures:35\r\n    END\r\n\r\nNote: `status:down` even though `num_servers_down` is 0 and it actually isn't down.\r\n\r\n### get __mcrouter__.preprocessed_config\r\n\r\n    {\r\n      \"pools\" : {\r\n        \"midw\" : {\r\n          \"servers\" : [\r\n            \"memcached7.midw.example.com:11211\",\r\n            \"memcached8.midw.example.com:11211\",\r\n            \"memcached9.midw.example.com:11211\"\r\n          ]\r\n        },\r\n        \"midw-gutter\" : {\r\n          \"servers\" : [\r\n            \"gutter3-c.midw.example.com:11211\"\r\n          ]\r\n        },\r\n        \"east\" : {\r\n          \"servers\" : [\r\n            \"memcached4.east.example.com:11211\",\r\n            \"memcached5.east.example.com:11211\",\r\n            \"memcached6.east.example.com:11211\"\r\n          ]\r\n        },\r\n        \"east-gutter\" : {\r\n          \"servers\" : [\r\n            \"gutter2-b.east.example.com:11211\"\r\n          ]\r\n        },\r\n        \"west\" : {\r\n          \"servers\" : [\r\n            \"memcached1.west.example.com:11211\",\r\n            \"memcached2.west.example.com:11211\",\r\n            \"memcached3.west.example.com:11211\"\r\n          ]\r\n        },\r\n        \"west-gutter\" : {\r\n          \"servers\" : [\r\n            \"gutter1-a.west.example.com:11211\"\r\n          ]\r\n        }\r\n      },\r\n      \"route\" : {\r\n        \"default_policy\" : {\r\n          \"failover\" : \"PoolRoute|west-gutter\",\r\n          \"failover_exptime\" : 300,\r\n          \"normal\" : \"PoolRoute|west\",\r\n          \"type\" : \"FailoverWithExptimeRoute\"\r\n        },\r\n        \"operation_policies\" : {\r\n          \"delete\" : {\r\n            \"children\" : [\r\n              {\r\n                \"failover\" : \"PoolRoute|west-gutter\",\r\n                \"failover_exptime\" : 300,\r\n                \"normal\" : \"PoolRoute|west\",\r\n                \"type\" : \"FailoverWithExptimeRoute\"\r\n              },\r\n              {\r\n                \"failover\" : \"PoolRoute|midw-gutter\",\r\n                \"failover_exptime\" : 300,\r\n                \"normal\" : \"PoolRoute|midw\",\r\n                \"type\" : \"FailoverWithExptimeRoute\"\r\n              },\r\n              {\r\n                \"failover\" : \"PoolRoute|east-gutter\",\r\n                \"failover_exptime\" : 300,\r\n                \"normal\" : \"PoolRoute|east\",\r\n                \"type\" : \"FailoverWithExptimeRoute\"\r\n              }\r\n            ],\r\n            \"type\" : \"AllFastestRoute\"\r\n          }\r\n        },\r\n        \"type\" : \"OperationSelectorRoute\"\r\n      }\r\n    }\r\n    END\r\n\r\n#### stats all\r\n\r\n    STAT asynclog_requests 0\r\n    STAT client_queue_notifications 0\r\n    STAT client_queue_notify_period 0\r\n    STAT cmd_add 0\r\n    STAT cmd_add_count 0\r\n    STAT cmd_add_out 0\r\n    STAT cmd_add_out_all 0\r\n    STAT cmd_add_out_all_count 0\r\n    STAT cmd_add_out_count 0\r\n    STAT cmd_cas 0\r\n    STAT cmd_cas_count 0\r\n    STAT cmd_cas_out 0\r\n    STAT cmd_cas_out_all 0\r\n    STAT cmd_cas_out_all_count 0\r\n    STAT cmd_cas_out_count 0\r\n    STAT cmd_cas_outlier 0\r\n    STAT cmd_cas_outlier_all 0\r\n    STAT cmd_cas_outlier_all_count 0\r\n    STAT cmd_cas_outlier_count 0\r\n    STAT cmd_decr 0\r\n    STAT cmd_decr_count 0\r\n    STAT cmd_decr_out 0\r\n    STAT cmd_decr_out_all 0\r\n    STAT cmd_decr_out_all_count 0\r\n    STAT cmd_decr_out_count 0\r\n    STAT cmd_delete 0.816667\r\n    STAT cmd_delete_count 12263\r\n    STAT cmd_delete_out 2.45\r\n    STAT cmd_delete_out_all 2.45\r\n    STAT cmd_delete_out_all_count 36849\r\n    STAT cmd_delete_out_count 36789\r\n    STAT cmd_delete_outlier 0\r\n    STAT cmd_delete_outlier_all 0\r\n    STAT cmd_delete_outlier_all_count 0\r\n    STAT cmd_delete_outlier_count 0\r\n    STAT cmd_get 127.05\r\n    STAT cmd_get_count 16151412\r\n    STAT cmd_get_out 127.05\r\n    STAT cmd_get_out_all 127.05\r\n    STAT cmd_get_out_all_count 16151583\r\n    STAT cmd_get_out_count 16151407\r\n    STAT cmd_get_outlier 0\r\n    STAT cmd_get_outlier_all 0\r\n    STAT cmd_get_outlier_all_count 0\r\n    STAT cmd_get_outlier_count 0\r\n    STAT cmd_gets 0\r\n    STAT cmd_gets_count 0\r\n    STAT cmd_gets_out 0\r\n    STAT cmd_gets_out_all 0\r\n    STAT cmd_gets_out_all_count 0\r\n    STAT cmd_gets_out_count 0\r\n    STAT cmd_gets_outlier 0\r\n    STAT cmd_gets_outlier_all 0\r\n    STAT cmd_gets_outlier_all_count 0\r\n    STAT cmd_gets_outlier_count 0\r\n    STAT cmd_incr 0\r\n    STAT cmd_incr_count 0\r\n    STAT cmd_incr_out 0\r\n    STAT cmd_incr_out_all 0\r\n    STAT cmd_incr_out_all_count 0\r\n    STAT cmd_incr_out_count 0\r\n    STAT cmd_lease_get 0\r\n    STAT cmd_lease_get_count 0\r\n    STAT cmd_lease_get_out 0\r\n    STAT cmd_lease_get_out_all 0\r\n    STAT cmd_lease_get_out_all_count 0\r\n    STAT cmd_lease_get_out_count 0\r\n    STAT cmd_lease_set 0\r\n    STAT cmd_lease_set_count 0\r\n    STAT cmd_lease_set_out 0\r\n    STAT cmd_lease_set_out_all 0\r\n    STAT cmd_lease_set_out_all_count 0\r\n    STAT cmd_lease_set_out_count 0\r\n    STAT cmd_meta 0\r\n    STAT cmd_meta_count 0\r\n    STAT cmd_meta_out 0\r\n    STAT cmd_meta_out_all 0\r\n    STAT cmd_meta_out_all_count 0\r\n    STAT cmd_meta_out_count 0\r\n    STAT cmd_other 0\r\n    STAT cmd_other_count 0\r\n    STAT cmd_other_out 0\r\n    STAT cmd_other_out_all 0\r\n    STAT cmd_other_out_all_count 0\r\n    STAT cmd_other_out_count 0\r\n    STAT cmd_other_outlier 0\r\n    STAT cmd_other_outlier_all 0\r\n    STAT cmd_other_outlier_all_count 0\r\n    STAT cmd_other_outlier_count 0\r\n    STAT cmd_replace 0\r\n    STAT cmd_replace_count 0\r\n    STAT cmd_replace_out 0\r\n    STAT cmd_replace_out_all 0\r\n    STAT cmd_replace_out_all_count 0\r\n    STAT cmd_replace_out_count 0\r\n    STAT cmd_set 15.0208\r\n    STAT cmd_set_count 2329473\r\n    STAT cmd_set_out 15.0208\r\n    STAT cmd_set_out_all 15.0208\r\n    STAT cmd_set_out_all_count 2329490\r\n    STAT cmd_set_out_count 2329473\r\n    STAT cmd_set_outlier 0\r\n    STAT cmd_set_outlier_all 0\r\n    STAT cmd_set_outlier_all_count 0\r\n    STAT cmd_set_outlier_count 0\r\n    STAT cmd_stats 0.2\r\n    STAT cmd_stats_count 21976\r\n    STAT commandargs /etc/mcrouter/flavor\r\n    STAT config_age 109830\r\n    STAT config_failures 0\r\n    STAT config_last_attempt 1492018246\r\n    STAT config_last_success 1492018246\r\n    STAT cycles_avg 0\r\n    STAT cycles_max 0\r\n    STAT cycles_min 0\r\n    STAT cycles_num 0\r\n    STAT cycles_p01 0\r\n    STAT cycles_p05 0\r\n    STAT cycles_p50 0\r\n    STAT cycles_p95 0\r\n    STAT cycles_p99 0\r\n    STAT destination_batch_size 1\r\n    STAT destination_batches_sum 144.521\r\n    STAT destination_inflight_reqs 0\r\n    STAT destination_max_inflight_reqs 9\r\n    STAT destination_max_pending_reqs 9\r\n    STAT destination_pending_reqs 0\r\n    STAT destination_requests_sum 144.521\r\n    STAT dev_null_requests 0\r\n    STAT duration_us 1226.12\r\n    STAT failover_all 0\r\n    STAT failover_all_failed 0\r\n    STAT failover_rate_limited 0\r\n    STAT fibers_allocated 242\r\n    STAT fibers_pool_size 242\r\n    STAT fibers_stack_high_watermark 6576\r\n    STAT num_clients 9\r\n    STAT num_servers 96\r\n    STAT num_servers_closed 19\r\n    STAT num_servers_down 0\r\n    STAT num_servers_new 53\r\n    STAT num_servers_up 24\r\n    STAT num_suspect_servers 1\r\n    STAT outstanding_route_get_avg_queue_size 0\r\n    STAT outstanding_route_get_avg_wait_time_sec 0\r\n    STAT outstanding_route_get_reqs_queued 0\r\n    STAT outstanding_route_get_reqs_queued_helper 0\r\n    STAT outstanding_route_get_wait_time_sum_us 0\r\n    STAT outstanding_route_update_avg_queue_size 0\r\n    STAT outstanding_route_update_avg_wait_time_sec 0\r\n    STAT outstanding_route_update_reqs_queued 0\r\n    STAT outstanding_route_update_reqs_queued_helper 0\r\n    STAT outstanding_route_update_wait_time_sum_us 0\r\n    STAT parent_pid 0\r\n    STAT pid 1\r\n    STAT proxy_reqs_processing 1\r\n    STAT proxy_reqs_waiting 0\r\n    STAT proxy_request_num_outstanding 1\r\n    STAT ps_num_major_faults 0\r\n    STAT ps_num_minor_faults 40109\r\n    STAT ps_rss 63787008\r\n    STAT ps_system_time_sec 1789.44\r\n    STAT ps_user_time_sec 1977.79\r\n    STAT ps_vsize 310837248\r\n    STAT rate_limited_log_count 0\r\n    STAT redirected_lease_set_count 0\r\n    STAT replies_compressed 0\r\n    STAT replies_not_compressed 0\r\n    STAT reply_traffic_after_compression 0\r\n    STAT reply_traffic_before_compression 0\r\n    STAT request_error 0\r\n    STAT request_error_count 0\r\n    STAT request_replied 143.088\r\n    STAT request_replied_count 18515123\r\n    STAT request_sent 143.088\r\n    STAT request_sent_count 18515123\r\n    STAT request_success 143.088\r\n    STAT request_success_count 18515123\r\n    STAT result_busy 0\r\n    STAT result_busy_all 0\r\n    STAT result_busy_all_count 0\r\n    STAT result_busy_count 0\r\n    STAT result_connect_error 0\r\n    STAT result_connect_error_all 0\r\n    STAT result_connect_error_all_count 0\r\n    STAT result_connect_error_count 0\r\n    STAT result_connect_timeout 0\r\n    STAT result_connect_timeout_all 0\r\n    STAT result_connect_timeout_all_count 0\r\n    STAT result_connect_timeout_count 0\r\n    STAT result_data_timeout 0\r\n    STAT result_data_timeout_all 0\r\n    STAT result_data_timeout_all_count 288\r\n    STAT result_data_timeout_count 253\r\n    STAT result_error 0\r\n    STAT result_error_all 0\r\n    STAT result_error_all_count 288\r\n    STAT result_error_count 253\r\n    STAT result_local_error 0\r\n    STAT result_local_error_all 0\r\n    STAT result_local_error_all_count 0\r\n    STAT result_local_error_count 0\r\n    STAT result_tko 0\r\n    STAT result_tko_all 0\r\n    STAT result_tko_all_count 0\r\n    STAT result_tko_count 0\r\n    STAT retrans_closed_connections 0\r\n    STAT retrans_num_total 0\r\n    STAT retrans_per_kbyte_avg 0\r\n    STAT retrans_per_kbyte_max 0\r\n    STAT retrans_per_kbyte_sum 0\r\n    STAT rusage_system 1789.45\r\n    STAT rusage_user 1977.8\r\n    STAT start_time 1492018246\r\n    STAT successful_client_connections 14\r\n    STAT time 1492128076\r\n    STAT uptime 109830\r\n    STAT version 35.0.0 mcrouter\r\n    END\r\n\r\n#### get __mcrouter__.options\r\n\r\n    service_name mcrouter\r\n    router_name flavor\r\n    flavor_name /etc/mcrouter/flavor\r\n    asynclog_disable 1\r\n    async_spool /var/spool/mcrouter\r\n    use_asynclog_version2 1\r\n    num_proxies 8\r\n    client_queue_size 1024\r\n    client_queue_no_notify_rate 0\r\n    client_queue_wait_threshold_us 0\r\n    big_value_split_threshold 0\r\n    big_value_batch_size 10\r\n    fibers_max_pool_size 1000\r\n    fibers_stack_size 24576\r\n    fibers_record_stack_size_every 100000\r\n    fibers_use_guard_pages 1\r\n    runtime_vars_file \r\n    file_observer_poll_period_ms 100\r\n    file_observer_sleep_before_update_ms 1000\r\n    fibers_pool_resize_period_ms 60000\r\n    keepalive_cnt 0\r\n    keepalive_interval_s 60\r\n    keepalive_idle_s 300\r\n    reset_inactive_connection_interval 60000\r\n    tcp_rto_min -1\r\n    target_max_inflight_requests 0\r\n    target_max_pending_requests 100000\r\n    target_max_shadow_requests 1000\r\n    no_network 0\r\n    proxy_max_inflight_requests 0\r\n    proxy_max_throttled_requests 0\r\n    pem_cert_path \r\n    pem_key_path \r\n    pem_ca_path \r\n    enable_qos 0\r\n    default_qos_class 0\r\n    default_qos_path 0\r\n    ssl_connection_cache 0\r\n    enable_compression 0\r\n    constantly_reload_configs 0\r\n    disable_reload_configs 0\r\n    config \r\n    config_file /etc/mcrouter/mcrouter.conf\r\n    config_str \r\n    default_route /././\r\n    miss_on_get_errors 1\r\n    group_remote_errors 0\r\n    send_invalid_route_to_default 0\r\n    enable_flush_cmd 0\r\n    reconfiguration_delay_ms 1000\r\n    config_params \r\n    disable_tko_tracking 0\r\n    probe_delay_initial_ms 2000\r\n    probe_delay_max_ms 10000\r\n    failures_until_tko 500\r\n    maximum_soft_tkos 2\r\n    allow_only_gets 0\r\n    server_timeout_ms 20\r\n    cross_region_timeout_ms 0\r\n    cross_cluster_timeout_ms 0\r\n    within_cluster_timeout_ms 0\r\n    waiting_request_timeout_ms 0\r\n    jemalloc_nodump_buffers 0\r\n    stats_root /var/mcrouter/stats\r\n    debug_fifo_root /var/mcrouter/fifos\r\n    stats_logging_interval 10000\r\n    logging_rtt_outlier_threshold_us 0\r\n    stats_async_queue_length 50\r\n    enable_failure_logging 1\r\n    cpu_cycles 0\r\n    test_mode 0\r\n    enable_logging_route 0\r\n    collect_rxmit_stats_every_hz 0\r\n    min_rxmit_reconnect_threshold 0\r\n    max_rxmit_reconnect_threshold 0\r\n    asynclog_port_override 0\r\n    log_file /var/log/mcrouter/mcrouter.log\r\n    ports 11211\r\n    ssl_ports \r\n    listen_sock_fd -1\r\n    unix_domain_sock \r\n    max_conns 0\r\n    tcp_listen_backlog 128\r\n    max_client_outstanding_reqs 34133\r\n    requests_per_read 0\r\n    retain_source_ip 0\r\n    postprocess_logging_route 0\r\n    enable_server_compression 0\r\n    client_timeout_ms 20\r\n    END", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/189/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/186", "title": "Bug: Memcached CLIENT_ERRORs Not Being Forwarded", "body": "## Summary\r\n\r\nIn certain situations where Memcached returns a CLIENT_ERROR with a highly tailored message (and keeps the connection open), Mcrouter is replacing the message with _malformed request_ and is closing the connection.\r\n\r\nMcrouter version: 0.35.0\r\nMemcached version: 1.4.36\r\n\r\n## Examples\r\n\r\nFirst, as a baseline, an example where Mcrouter correctly forwards the originating CLIENT_ERROR:\r\n\r\nBoth mcrouter and memcached when presented with:\r\n\r\n```\r\ndelete foo 1\r\n```\r\n\r\nwill return:\r\n\r\n```\r\nCLIENT_ERROR bad command line format.  Usage: delete <key> [noreply]\r\n```\r\n\r\nWith that said, here are examples where the CLIENT_ERROR is _not_ forwarded.\r\n\r\n**1. incr/decr an existing non-numeric value**\r\n\r\n```\r\nset foo 0 0 1\r\na\r\nSTORED\r\nincr foo 1\r\n```\r\n\r\nMemcached: `CLIENT_ERROR cannot increment or decrement non-numeric value`\r\nMcrouter: `NOT_FOUND`\r\n\r\nNote: This one is of more interest than the ones below, because it returns an incorrect NOT_FOUND vs. a less optimal CLIENT_ERROR message. Returning a CLIENT_ERROR with _malformed request_ would be more correct.\r\n\r\n**2. incr/decr with invalid delta argument**\r\n\r\n```\r\nincr foo 0.2\r\n```\r\n\r\nMemcached: `CLIENT_ERROR invalid numeric delta argument` and keeps the connection open.\r\nMcrouter: `CLIENT_ERROR malformed request` and closes the connection.\r\n\r\n**3. touch with an invalid exptime**\r\n\r\n```\r\ntouch foo 0.2\r\n```\r\n\r\nMemcached: `CLIENT_ERROR invalid exptime argument` and keeps the connection open.\r\nMcrouter: `CLIENT_ERROR malformed request` and closes the connection.\r\n\r\n**4. set with exptime as invalid numeric value**\r\n\r\n```\r\nset foo 0 0.0 1\r\n```\r\n\r\nMemcached: `CLIENT_ERROR bad command line format` and keeps the connection open.\r\nMcrouter : `CLIENT_ERROR malformed request` and closes the connection.\r\n\r\n## Expected Behavior\r\n\r\n* Mcrouter does not close the connection on CLIENT_ERRORs\r\n  * Per the memcached protocol specification: A SERVER_ERROR is \"is the only case in\r\n     which the server closes a connection to a client.\" (https://github.com/memcached/memcached/blob/70942bdf061d69e294d7eb94bcde2a9eec971c66/doc/protocol.txt#L109-L116)\r\n* Mcrouter forwards/keeps the original CLIENT_ERROR message", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/186/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/184", "title": "Documentation - NullRoute Enhancements", "body": "Current documentation for NullRoute:\r\n\r\n```\r\nNullRoute\r\n\r\nReturns the default reply for each request right away. Default replies are:\r\n\r\n* delete - not found\r\n* get - not found\r\n* set - not stored\r\n\r\nNo properties.\r\n```\r\n\r\nThis is:\r\n\r\n* Missing the default reply for add, replace, cas, append, prepend, touch.\r\n* Confusing for the reply for `get` (\"not found\" can be misleading because the user might interpret this as NOT_FOUND vs. a miss).\r\n\r\nSuggested documentation for NullRoute:\r\n\r\n-------\r\n\r\n### NullRoute\r\n\r\nReturns the default reply for each request right away. Default replies are:\r\n\r\n* get, gets: nothing (miss)\r\n* delete, touch, incr, decr: NOT_FOUND\r\n* add, set, replace, cas, append, prepend: NOT_STORED\r\n\r\nNo properties.", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/184/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/183", "title": "Behavior for ModifyExptimeRoute on incr, decr, or get-like Commands Unclear", "body": "**Summary**\r\n\r\nSee https://github.com/facebook/mcrouter/wiki/List-of-Route-Handles#modifyexptimeroute\r\n\r\n`ModifyExptimeRoute` when used via `OperationSelectorRoute` for `incr`, `decr`, `get`, `gets`, & `delete` is effectively a no-op. This behavior is not clear from the existing documentation:\r\n\r\n\r\n> Modifies exptime (TTL) for all requests.\r\n>\r\n> Properties:\r\n> \r\n> * target: child route handle.\r\n> * exptime (int)\r\n>   New TTL (in seconds) for requests.\r\n> * action (optional, default is set) Valid options: set or min. If action is set, always uses new exptime. If action is min, uses new exptime only if it's lower than one specified in request.\r\n\r\nNote the \"all requests\" line.\r\n\r\nA user of mcrouter might assume that `ModifyExptimeRoute` fires an async `touch` command with the desired `exptime` after an `incr`/`decr`/`get`/`gets`, which it does not.\r\n\r\n**Options**\r\n\r\nEither:\r\n\r\n1. Treat the use of `ModifyExptimeRoute` as a configuration error if used for `incr`, `decr`, `get`, `gets`, and/or `delete`.\r\n2. Update the documentation to include this behavior/quirk\r\n3. Enhance mcrouter to send an async `touch` with the desired `exptime` after the `incr`, `decr`, `get`, or `gets` command.\r\n4. Other?\r\n\r\n(3) doesn't seem useful, so I'd suggest either (1) or (2). Thoughts?", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/183/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/182", "title": "Bug: OperationSelectorRoute with incr/decr ErrorRoute Broken", "body": "**Summary**\r\n\r\nIf `OperationSelectorRoute` is used, and `incr`/`decr` are set to use `ErrorRoute`, the response from an `incr`/`decr` command is not the `ErrorRoute` value as expected, but instead it's `NOT_FOUND`.\r\n\r\nReproducible on mcrouter 0.35.0 (latest).\r\n\r\n**How to Reproduce**\r\n\r\n```\r\n{\r\n  \"pools\": {\r\n    \"main\": {\r\n      \"servers\": [\r\n        \"memcached1:11211\",\r\n        \"memcached2:11211\",\r\n        \"memcached3:11211\"\r\n      ]\r\n    }\r\n  },\r\n  \"route\": {\r\n    \"type\": \"OperationSelectorRoute\",\r\n    \"operation_policies\": {\r\n      \"add\": \"ErrorRoute|MyErrorValueHere\",\r\n      \"get\": \"ErrorRoute|MyErrorValueHere\",\r\n      \"incr\": \"ErrorRoute|MyErrorValueHere\",\r\n      \"decr\": \"ErrorRoute|MyErrorValueHere\",\r\n      \"set\": \"ErrorRoute|MyErrorValueHere\",\r\n      \"replace\": \"ErrorRoute|MyErrorValueHere\",\r\n      \"append\": \"ErrorRoute|MyErrorValueHere\",\r\n      \"prepend\": \"ErrorRoute|MyErrorValueHere\",\r\n      \"touch\": \"ErrorRoute|MyErrorValueHere\",\r\n      \"cas\": \"ErrorRoute|MyErrorValueHere\",\r\n      \"delete\": \"ErrorRoute|MyErrorValueHere\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nNote how `add`, `set`, etc. all respond as expected:\r\n\r\n```\r\n$ telnet localhost 11211\r\nTrying ::1...\r\nConnected to localhost.\r\nEscape character is '^]'.\r\n\r\nset foo 0 0 1\r\n0\r\nSERVER_ERROR MyErrorValueHere\r\n\r\nadd foo 0 0 1\r\n0\r\nSERVER_ERROR MyErrorValueHere\r\n```\r\n\r\nBut `incr` and `decr` do not:\r\n\r\n```\r\nincr foo 1 \r\nNOT_FOUND\r\n\r\ndecr foo 1\r\nNOT_FOUND\r\n```\r\n\r\n**Expected Result**\r\n\r\n`incr` and `decr` respond with `SERVER_ERROR MyErrorValueHere`.", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/182/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/180", "title": "Feature Request: AllSizeRoute", "body": "I have a feature request for a new Route: AllSizeRoute.\r\n\r\nProperties:\r\n\r\n* `size`: `max` or `min`\r\n\r\nImmediately sends the same request to all child route handles.\r\nCollects all replies and responds with the `size` reply.\r\n\r\nFor numbers => min == smallest reply value (e.g. If 0, 5, & 14 came back, return 0)\r\nFor numbers => max == largest reply value (e.g. If 0, 5, & 14 came back, return 14)\r\n\r\n* If all replies are errors, returns the last error.\r\n* If all replies are not numbers, returns an error.\r\n* If some replies are not numbers, return the `size` reply of those that _are_ numbers.\r\n\r\nWhy:\r\n\r\nIf using mcrouter to create a highly-available (replicated, no spof)\r\ncounter cluster, where counters can only increase, no existing routes\r\ncan return the largest value from all child route handles. The best\r\nthat can be achieved at the moment (afaik) is:\r\n\r\n\r\n```\r\n{\r\n  \"pools\": {\r\n    \"main\": {\r\n      \"servers\": [\r\n        \"memcached1:11211\",\r\n        \"memcached2:11211\",\r\n        \"memcached3:11211\"\r\n      ]\r\n    }\r\n  },\r\n  \"route\": {\r\n    \"type\": \"OperationSelectorRoute\",\r\n    \"operation_policies\": {\r\n      \"add\": \"AllFastestRoute|Pool|main\",\r\n      \"get\": {\r\n        \"type\": \"MissFailoverRoute\",\r\n        \"children\": [\r\n          \"AllMajorityRoute|Pool|main\",\r\n          \"AllFastestRoute|Pool|main\"\r\n        ]\r\n      },\r\n      \"incr\": \"AllFastestRoute|Pool|main\",\r\n      \"decr\": \"AllFastestRoute|Pool|main\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nUsing `AllMajorityRoute` on `get` ensures that a missed `incr` on\r\none memcached doesn't impact the returned value, but it's far from\r\nbullet proof (ex: if `incr` is applied only on 1 of the 3, it undercounts).\r\n\r\nNote: Concept could be extended to Strings (Min/Max == Smallest or\r\nLongest value length (e.g. \"foo\" < \"foobar\").\r\n\r\nNote: `size` option list could be extended to include `median`, `avg`,\r\n`95th%`, etc.\r\n\r\nIf there's already a better way of achieving this, please let me know,\r\nI might have missed an available Route (or a clever way of composing\r\nthem). Thanks!\r\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/180/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "fredemmott": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/220", "title": "Replace direct usage of linux/futex.h with folly::futex", "body": "this would get mcrouter a fair bit closer to building on mac, which would be nice for the HHVM extension", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/220/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "mandeepsandhu": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/219", "title": "Feature Request: Debian 9 build support", "body": "Support Debian **9** (stretch) as one of the build platforms.", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/219/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "agarbato": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/217", "title": "WarmUp and Replication to All nodes.", "body": "Hi,\r\n\r\nIs it possible to use the WarmUpRoute and Replication together?\r\n\r\nBasically we have an old box with memcache which in time we would like to decommission.\r\nUsing the config below set,add,delete are  replicated to all nodes as expected.\r\nWhen the cold pool instead receive a miss the key is added only on one node of the cold pool.\r\nIs it possible somehow to add key to all nodes instead like AllSyncRoute behavior? \r\n\r\n{\r\n   \"pools\": {\r\n     \"cold\": { \r\n        \"servers\": [ \"1.1.1.10:11211\", \"1.1.1.11:11211\" ] },\r\n     \"warm\": { \r\n        \"servers\": [ \"1.1.1.15:11211\" ] }\r\n   },\r\n   \"route\": {\r\n     \"type\": \"OperationSelectorRoute\",\r\n     \"operation_policies\": {\r\n       \"get\": {\r\n         \"type\": \"WarmUpRoute\",\r\n         \"cold\": \"PoolRoute|cold\",\r\n         \"warm\": \"PoolRoute|warm\"\r\n       },\r\n       \"set\": \"AllSyncRoute|Pool|cold\",\r\n       \"add\": \"AllSyncRoute|Pool|cold\",\r\n       \"delete\": \"AllSyncRoute|Pool|cold\"\r\n     } \r\n   }\r\n}\r\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/217/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "cthayer": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/210", "title": "Consider changing license", "body": "With the recent community uproar around FaceBook's BSD+Patents licensing and the announcement that other FaceBook OSS projects (most notably React.js) are changing to an MIT license (https://code.facebook.com/posts/300798627056246), I'd like to propose that mcrouter follow suit and change it's license to a more community friendly license.\r\n\r\nDefinitely appreciate all the hard work and effort of the mcrouter team.  This project is super awesome! ", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/210/reactions", "total_count": 6, "+1": 6, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "qhdwns123": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/203", "title": "bulid error", "body": "Hi.\r\n\r\nI get the following error on Ubuntu 16.04.\r\n\r\nmake[2]: Entering directory '/root/mcrouter'\r\ng++ -DHAVE_CONFIG_H   -I.. -I/home/root/mcrouter-install/install/include   -DLIBMo-unused-parameter -fno-strict-aliasing -g -O2 -std=gnu++1y -MT libmcroutercore_ayncLog.o `test -f 'AsyncLog.cpp' || echo './'`AsyncLog.cpp\r\nIn file included from ../mcrouter/CarbonRouterClient.h:16:0,\r\n                 from ../mcrouter/CarbonRouterInstance.h:23,\r\n                 from AsyncLog.cpp:29:\r\n../mcrouter/lib/CacheClientStats.h:13:40: fatal error: folly/detail/CacheLocality\r\ncompilation terminated.\r\nMakefile:884: recipe for target 'libmcroutercore_a-AsyncLog.o' failed\r\nmake[2]: *** [libmcroutercore_a-AsyncLog.o] Error 1\r\nmake[2]: Leaving directory '/root/mcrouter'\r\nMakefile:1515: recipe for target 'all-recursive' failed\r\nmake[1]: *** [all-recursive] Error 1\r\nmake[1]: Leaving directory '/root/mcrouter'\r\nMakefile:663: recipe for target 'all' failed\r\nmake: *** [all] Error 2\r\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/203/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "eminugurkenar": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/202", "title": "Eject Down Servers", "body": "Version: 35.0.0-master mcrouter\r\n\r\nHi,\r\nI am testing FailoverRoute with configuration below. \r\n\r\nThe test\r\n```\r\n1-) set a key 'echo -e 'set mykey 0 600 5\\r\\nhello1\\r' | nc localhost 11311'\r\n2-) block connection to port 11211 on server that 'mykey' goes. 'iptables -A INPUT -p tcp --dport 11211 -j DROP' \r\n3-) delete key 'echo -e 'delete mykey\\r' | nc localhost 11311'\r\n4-) set same key again 'echo -e 'set mykey 0 600 5\\r\\nhello2\\r' | nc localhost 11311' (key goes to failover server)\r\n5-) get key 'echo -e 'mykey a\\r' | nc localhost 11311' (returns hello2)\r\n6-) flush iptables rules on main server. iptables -F\r\n7-) get key 'echo -e 'mykey a\\r' | nc localhost 11311' (returns hello1)\r\n```\r\n\r\nYou can see that if main pool server comebacks , mcrouter returns stale data. As i understand from that issue (https://github.com/facebook/mcrouter/issues/105 jmswen comment), it is our responsibility to apply delete stream to right memcached instance. Right now we do not have any agent that keeps track of the delete stream then applies them to right server. \r\n\r\nIs there a way to eject down server from the pool? It will be very usefull for that situation. We can easly flush ejected server then add it back to the pool. That way the problem described above will not be a issue for us. \r\n\r\nConfiguration:\r\n\r\n```\r\n{\r\n   \"pools\": {\r\n     \"main\": {\r\n       \"servers\": [\r\n         \"172.31.84.43:11211\",\r\n         \"172.31.84.48:11211\"\r\n       ]\r\n     },\r\n     \"backup\": {\r\n       \"servers\": [\r\n         \"172.31.84.201:11211\"\r\n       ]\r\n     }\r\n   },\r\n   \"route\":{\r\n     \"type\": \"FailoverRoute\",\r\n     \"children\" : [\"PoolRoute|main\", \"PoolRoute|backup\" ]\r\n   }\r\n}\r\n```", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/202/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "ssabo": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/198", "title": "McRouter memory exhaustion", "body": ":wave: Howdy!\r\n\r\nWe recently noticed that OOM Killer was cleaning up our mcrouter processes fairly often. During periods where the rate of traffic increased sharply, mcrouter would consume several GB of ram which never seemed to get released. This would happen 2-4 times before OOM Killer would be invoked. \r\n\r\nValgrind reported there was no memory leak. When we analyzed core dumps, we found most of the strings in memory were the values for the keys we were manipulating. \r\n\r\n**Before**\r\n![Memory Used Steep Increases and OOM](https://cloud.githubusercontent.com/assets/2396369/26738029/73c75180-4781-11e7-9faf-94222f1f09ba.png)\r\n\r\nOur current workaround has been to export `GLIBCXX_FORCE_NEW=1`. \r\n\r\n**After**\r\n![Memory Used Steep Increases and Reclaimed](https://cloud.githubusercontent.com/assets/2396369/26738240/3b550cb0-4782-11e7-8b1f-f62e1be20902.png)\r\n\r\n\r\nWe were wondering if this is how others handle sharp traffic increases and if there are other actions we can take?", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/198/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "mohit-gupta-hs1": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/196", "title": "Using mcrouter as a migration tool", "body": "Hey guys, we currently use Twemproxy for memcached connection pooling and hashing. We are moving some of our infrastructure from AWS classic into a VPC and we would like to use mcrouter to shadow all the traffic to the cluster in classic (serving prod traffic) to another cluster in VPC. When the caches become someone consistent we would then do an application config change (or change a setting on mcrouter maybe?) to flip to the new pool. However, we are having some issues in our staging environment and mcrouter, particularly around deletes.We see cache invalidation issues, values still being in the cache when they should have been deleted. \r\nSince we use twemproxy for hashing (and mcrouter doesn't have the same hashing algorithm) we have configured two backends in it, one for the classic pool and one for the VPC pool, and then mcrouter is setup to point to both twemproxy backends with the following config:\r\n\r\n```\r\n// This config file is generated by Ansible from\r\n// the mcrouter_config YAML parameter and converted\r\n// to json.  See https://github.com/facebook/mcrouter/wiki/Config-Files\r\n\r\n{\r\n    \"pools\": {\r\n        \"twemproxy\": {\r\n            \"servers\": [\r\n                \"localhost:22122\"\r\n            ]\r\n        },\r\n        \"vpc\": {\r\n            \"servers\": [\r\n                \"localhost:22123\"\r\n            ]\r\n        }\r\n    },\r\n    \"route\": {\r\n        \"pool\": \"twemproxy\",\r\n        \"shadows\": [\r\n            {\r\n                \"index_range\": [\r\n                    0,\r\n                    1\r\n                ],\r\n                \"key_fraction_range\": [\r\n                    0,\r\n                    1\r\n                ],\r\n                \"target\": {\r\n                    \"pool\": \"vpc\",\r\n                    \"type\": \"PoolRoute\"\r\n                }\r\n            }\r\n        ],\r\n        \"type\": \"PoolRoute\"\r\n    }\r\n}\r\n```\r\nWith this setup we get some issues around deletes. Specifically we see a lot of empty values in memcached, i.e.: \r\n```\r\n$ echo \"get stage1_key_here_12243571\" | nc memnew1.stage.us-east-1.hootops.com 11211\r\nVALUE stage1_key_here_12243571 4 6\r\na:0:{}\r\nEND\r\n```\r\nwhen it should actually be\r\n```\r\n$ echo \"get stage1_key_here_12243571\" | nc memnew1.stage.us-east-1.hootops.com 11211\r\nEND\r\n```\r\n\r\nDo you guys know of anyone who has tried mcrouter and twemproxy? Do you see any issues with the setup? ", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/196/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "yctn": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/193", "title": "Debian 8 build script", "body": "Hello,\r\n\r\nCould you maby provide a build script for Debian 8?\r\n\r\nim trying to compile it manualy but i keep running into issues i cant seem to resolve.", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/193/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "galitz": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/192", "title": "Thread crazieness (Y threads x num_cpu_cores)", "body": "Hi.\r\n\r\nWe are running mcrouter in a configuration where it launches with \"proxy-threads auto\" on 4 core servers.  So we are getting 4 threads per core.  However we are running 6 individual instances of mcrouter pointing to different memcache clusters.  So in this config on each server the effective number of threads is 6 * 4 for each server, but pointing to different pools.  In this particular case we have eight servers acting as mcrouter front-ends.  Some memcache clusters see high usage, others low.. it is quite mixed.\r\n\r\nMy question is if I am likely to run into race conditions/thread collisions that can effect performance or reliability?  I realize this is predicated on usage levels somewhat, but in general?\r\n\r\nWould tuning options such global-tko-tracking be beneficial?\r\n\r\nThanks.\r\n-G\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/192/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "netshade": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/187", "title": "Build Process Is Not Intuitive", "body": "I had some issues building a version of `mcrouter` to ship to different servers. After some amount of time trying to figure out the correct ordering of `mcrouter` HEAD, `WANGLE_COMMIT` and `FOLLY_COMMIT` values, I was able to create a binary, but the process seemed way too dependent on upstream OS ability to provide the correct versions of `boost`, `automake`, `autoconf`, `ragel`, `double-conversion`, `glog` and `gflag`. \r\n\r\nI wanted to automate this process so I could create binaries that were less dependent on the OS packaging dependencies, and so created this Dockerfile and workflow to generate a mcrouter artifact. The `ldd` hack I'm not particularly proud of / confident with, but it is at least getting me to the point where I'm able to experiment with `mcrouter`.\r\n\r\nIncluded are the Dockerfile and build scripts. Because this is currently more suited to my workflow than anything else, I'm making this an issue rather than a PR, but would promote this to a PR if any of this seems useful to the `mcrouter` team ( or random internet person who has the same problems I had w/ building this ).\r\n\r\nWorkflow:\r\n```\r\nmkdir target # Make the directory where artifact will be built\r\nsudo ./build.sh # Build the docker image\r\nsudo ./run.sh # Run the compile, mcrouter-v0.35.0.tar.bz2 will be in target/ after completion\r\n```\r\n\r\n# Dockerfile\r\n```\r\nFROM            centos:7\r\nMAINTAINER      mcrouter <mcrouter@fb.com>\r\nENV             BUILD_DIR               /opt/facebook\r\nENV             TARGET_DIR              /target/\r\nENV             GFLAGS_VERSION          v2.2.0\r\nENV             GLOG_VERSION            v0.3.4\r\nENV             DOUBLE_CONV_VERSION     v2.0.1\r\nENV             MCROUTER_VERSION        v0.35.0\r\nENV             FOLLY_COMMIT            81d9192f8afdf53fcbc7bf572f8ce638516380f8\r\nENV             WANGLE_COMMIT           f1704ef198062d9754e4a07857a737381d017140\r\nENV             PATH                    /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:$TARGET_DIR/bin:$TARGET_DIR/sbin\r\nENV             CFLAGS                  -I$TARGET_DIR/include/\r\nENV             CXXFLAGS                -I$TARGET_DIR/include/\r\nENV             CPPFLAGS                -I$TARGET_DIR/include/\r\nENV             LDFLAGS                 -L$TARGET_DIR/lib/ -Wl,-R,'$ORIGIN/../lib'\r\n\r\nRUN             yum -y install git\r\nRUN             yum -y groupinstall \"Development Tools\"\r\nRUN             yum -y install cmake\r\nRUN             yum -y install wget\r\nRUN             yum -y install openssl openssl-devel\r\nRUN             yum -y install libevent libevent-devel\r\nRUN             yum -y install python-devel\r\nRUN             yum -y install icu libicu libicu-devel\r\nRUN             yum -y install bzip2-devel\r\nRUN             yum -y install chrpath\r\nRUN             mkdir -p $BUILD_DIR\r\n\r\n# automake-1.14\r\nRUN             cd $BUILD_DIR && \\\r\n                  wget http://ftp.gnu.org/gnu/automake/automake-1.14.tar.gz && \\\r\n                  tar -zxvf ./automake-1.14.tar.gz\r\n\r\n# scons 2.5.1\r\nRUN             cd $BUILD_DIR && \\\r\n                  wget https://iweb.dl.sourceforge.net/project/scons/scons/2.5.1/scons-2.5.1-1.noarch.rpm && \\\r\n                  rpm -ivh scons-2.5.1-1.noarch.rpm\r\n\r\n# ragel 6.10\r\nRUN             cd $BUILD_DIR && \\\r\n                  wget \"http://www.colm.net/files/ragel/ragel-6.10.tar.gz\" && \\\r\n                  tar -zxvf ragel-6.10.tar.gz\r\n\r\n# gflags\r\nRUN             cd $BUILD_DIR && \\\r\n                  git clone https://github.com/schuhschuh/gflags.git && \\\r\n                  cd gflags && \\\r\n                  git checkout $GFLAGS_VERSION\r\n\r\n# glog\r\nRUN             cd $BUILD_DIR && \\\r\n                  git clone https://github.com/google/glog.git && \\\r\n                  cd glog && \\\r\n                  git checkout $GLOG_VERSION\r\n\r\n# double_conversion\r\nRUN             cd $BUILD_DIR && \\\r\n                  git clone https://github.com/google/double-conversion.git && \\\r\n                  cd double-conversion && \\\r\n                  git checkout $DOUBLE_CONV_VERSION\r\n\r\n# folly\r\nRUN             cd $BUILD_DIR && \\\r\n                  git clone https://github.com/facebook/folly.git && \\\r\n                  cd folly && \\\r\n                  git checkout $FOLLY_COMMIT\r\n\r\n# wangle\r\nRUN             cd $BUILD_DIR && \\\r\n                  git clone https://github.com/facebook/wangle.git && \\\r\n                  cd wangle && \\\r\n                  git checkout $WANGLE_COMMIT\r\n\r\n# mcrouter\r\nRUN             cd $BUILD_DIR && \\\r\n                  git clone https://github.com/facebook/mcrouter.git && \\\r\n                  cd mcrouter && \\\r\n                  git checkout $MCROUTER_VERSION\r\n\r\n# boost\r\nRUN             cd $BUILD_DIR && \\\r\n                  wget \"https://superb-dca2.dl.sourceforge.net/project/boost/boost/1.53.0/boost_1_53_0.tar.gz\" && \\\r\n                  tar -zxvf boost_1_53_0.tar.gz\r\n\r\nCMD             echo \"$TARGET_DIR/lib\" >> /etc/ld.so.conf && \\\r\n                cd $BUILD_DIR/automake-1.14 && ./configure --prefix=/usr/ && make && make install && ldconfig && \\\r\n                cd $BUILD_DIR/boost_1_53_0 && ./bootstrap.sh --prefix=$TARGET_DIR && ./b2 && ./b2 install && \\\r\n                cd $BUILD_DIR/ragel-6.10 && ./configure --prefix=$TARGET_DIR && make && make install && \\\r\n                cd $BUILD_DIR/gflags && cmake -DBUILD_SHARED_LIBS=ON -DBUILD_STATIC_LIBS=ON -DCMAKE_INSTALL_PREFIX:PATH=$TARGET_DIR . && make && make install && ldconfig && \\\r\n                cd $BUILD_DIR/glog && ./configure --enable-static --enable-shared --prefix=$TARGET_DIR && make && make install && ldconfig && \\\r\n                cd $BUILD_DIR/double-conversion && scons prefix=$TARGET_DIR && scons install prefix=$TARGET_DIR && cmake -DBUILD_SHARED_LIBS=ON -DBUILD_STATIC_LIBS=ON -DCMAKE_INSTALL_PREFIX:PATH=$TARGET_DIR . && make install && ldconfig && \\\r\n                cd $BUILD_DIR/folly/folly && autoreconf -ivf && ./configure --enable-static --enable-shared --prefix=$TARGET_DIR --with-boost=$TARGET_DIR && make && make install && ldconfig && \\\r\n                cd $BUILD_DIR/wangle/wangle && cmake -DBUILD_SHARED_LIBS=ON -DCMAKE_INSTALL_PREFIX:PATH=$TARGET_DIR -DFOLLY_INCLUDE_DIR=$TARGET_DIR/include/ -DFOLLY_LIBRARYDIR=$TARGET_DIR/lib/ . && make && make install && ldconfig && \\\r\n                cd $BUILD_DIR/mcrouter/mcrouter && AUTOMAKE=automake-1.14 ACLOCAL=\"aclocal-1.14 -I/usr/share/aclocal/\" ./autogen.sh && ./configure --enable-static --enable-shared --prefix=$TARGET_DIR --with-boost=$TARGET_DIR && make && make install && \\\r\n                for i in $(ldd $TARGET_DIR/bin/mcrouter  | egrep \"(icu|crypto|ssl)\" | egrep -o \"/[^ ]+\"); do cp $i /$TARGET_DIR/lib/; done && \\\r\n                chrpath -r \"\\$ORIGIN/../lib/\" $TARGET_DIR/bin/mcrouter && \\\r\n                chrpath -r \"\\$ORIGIN/../lib/\" $TARGET_DIR/bin/mcpiper && \\\r\n                cd $TARGET_DIR && tar -cjvf /tmp/mcrouter-$MCROUTER_VERSION.tar.bz2 bin/mcrouter bin/mcpiper lib/*.so lib/*.so.* && \\\r\n                mv /tmp/mcrouter-$MCROUTER_VERSION.tar.bz2 $TARGET_DIR\r\n\r\nVOLUME          [\"/target\"]\r\n```\r\n\r\n# build.sh\r\n```\r\n#!/bin/bash\r\ndocker build . -t mcrouter:latest\r\n```\r\n\r\n\r\n# run.sh\r\n```\r\n#!/bin/bash\r\ndocker run -v $(pwd)/target:/target mcrouter:latest\r\n```", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/187/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "deepub": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/175", "title": "How do leases work with Memcached and McRouter?", "body": "Hi Folks,\r\n\r\nI am trying to understand lease behavior since cas operations won't work with a distributed Memcached set up (replicated pools).\r\n\r\nReference: \"Scaling Memcache at Facebook\" white paper. Secton 3.2.1 Leases\r\n\r\n1) Who issues a lease? Is it the Memcached instance or McRouter? Memcached pull request is still open here https://github.com/memcached/memcached/pull/65\r\n2) Per the white paper, you have memcached instances giving out leases. Are you using stock Memcached or a custom fork? If it is a custom fork, is that open sourced? I checked the Facebook github repo and didn't find a custom fork there.\r\n3) I don't see any reference to lease handling in the memcached github repo. Ref: https://github.com/memcached/memcached\r\n4) I did find lease token references in McRouter code here\r\nmcrouter/LeaseTokenMap.h:   * @param leaseTokenTtl     How many milliseconds the lease token will live.\r\nmcrouter/LeaseTokenMap.h:      uint32_t leaseTokenTtl = 10000);\r\nand similarly ./mcrouter/test/test_mcrouter_basic.py references lease-get and lease-set calls.\r\n\r\nDoes this imply lease handling is a part of McRouter and not memcached? If yes, then how will mcrouter leases be handled across multiple mcrouter instances. I am assuming an embedded mode here for mcrouter.\r\n\r\nThanks a lot for the awesome work you are doing!", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/175/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/facebook/mcrouter/pulls/139", "title": "Create canned route configurations", "body": "The idea is to provide pre-canned route configurations. This will help users in multiple ways:\n1) Act as a tutorial for using multiple route configurations together to address a requirement.\n2) Allow users to hit the ground running. They can use such configurations and get going right away.\n", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "myhope001": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/169", "title": "mcrouter performance  and optimize", "body": "Dear engineer:\r\n                I use  python and pylibmc\r\n                At first,5 instances in aws directly connected memcached, the use of binary, about 24,000 per minute to deal with the request, which can meet our business needs.\r\n               Now, the instance cache points to the ELB (load balance),there are two mcrouters behind the ELB, and four memcached behind the mcrouters, but now it appears to deal with slower, and can not meet our business needs\u3002\r\n              So I would like to ask whether it can give me some suggestions for optimization\r\n              Thank you very much!\r\n\r\nThe following is our mcrouter information\uff1a\r\n stats all\r\nSTAT version 34.0.0-master mcrouter\r\nSTAT commandargs -L /var/log/mcrouter/mcrouter.log -f /usr/local/mcrouter/conf/mcrouter.json --num-proxies=4 -p 11211\r\nSTAT pid 5533\r\nSTAT parent_pid 5531\r\nSTAT time 1482134780\r\nSTAT uptime 16149\r\nSTAT num_servers 16\r\nSTAT num_servers_new 0\r\nSTAT num_servers_up 16\r\nSTAT num_servers_down 0\r\nSTAT num_servers_closed 0\r\nSTAT num_clients 17\r\nSTAT num_suspect_servers 0\r\nSTAT destination_batches_sum 9139.63\r\nSTAT destination_requests_sum 14007.9\r\nSTAT outstanding_route_get_reqs_queued 0\r\nSTAT outstanding_route_update_reqs_queued 0\r\nSTAT outstanding_route_get_avg_queue_size 0\r\nSTAT outstanding_route_update_avg_queue_size 0\r\nSTAT outstanding_route_get_avg_wait_time_sec 0\r\nSTAT outstanding_route_update_avg_wait_time_sec 0\r\nSTAT retrans_closed_connections 0\r\nSTAT outstanding_route_get_reqs_queued_helper 0\r\nSTAT outstanding_route_update_reqs_queued_helper 0\r\nSTAT outstanding_route_get_wait_time_sum_us 0\r\nSTAT outstanding_route_update_wait_time_sum_us 0\r\nSTAT retrans_per_kbyte_sum 0\r\nSTAT retrans_num_total 0\r\nSTAT destination_pending_reqs 0\r\nSTAT destination_inflight_reqs 12\r\nSTAT destination_batch_size 1.53265\r\nSTAT asynclog_requests 0\r\nSTAT proxy_reqs_processing 14\r\nSTAT proxy_reqs_waiting 0\r\nSTAT client_queue_notify_period 0\r\nSTAT rusage_system 3743.21\r\nSTAT rusage_user 3623.83\r\nSTAT ps_num_minor_faults 5226\r\nSTAT ps_num_major_faults 0\r\nSTAT ps_user_time_sec 3623.82\r\nSTAT ps_system_time_sec 3743.2\r\nSTAT ps_vsize 756711424\r\nSTAT ps_rss 15433728\r\nSTAT fibers_allocated 116\r\nSTAT fibers_pool_size 104\r\nSTAT fibers_stack_high_watermark 5760\r\nSTAT successful_client_connections 65558\r\nSTAT cycles_avg 0\r\nSTAT cycles_min 0\r\nSTAT cycles_max 0\r\nSTAT cycles_p01 0\r\nSTAT cycles_p05 0\r\nSTAT cycles_p50 0\r\nSTAT cycles_p95 0\r\nSTAT cycles_p99 0\r\nSTAT cycles_num 0\r\nSTAT duration_us 334.117\r\nSTAT destination_max_pending_reqs 64\r\nSTAT destination_max_inflight_reqs 67\r\nSTAT rate_limited_log_count 0\r\nSTAT cmd_cas_count 0\r\nSTAT cmd_delete_count 0\r\nSTAT cmd_get_count 185195824\r\nSTAT cmd_gets_count 0\r\nSTAT cmd_set_count 761411\r\nSTAT cmd_cas_outlier_count 0\r\nSTAT cmd_cas_outlier_all_count 0\r\nSTAT cmd_delete_outlier_count 0\r\nSTAT cmd_delete_outlier_all_count 0\r\nSTAT cmd_get_outlier_count 0\r\nSTAT cmd_get_outlier_all_count 0\r\nSTAT cmd_gets_outlier_count 0\r\nSTAT cmd_gets_outlier_all_count 0\r\nSTAT cmd_set_outlier_count 0\r\nSTAT cmd_set_outlier_all_count 0\r\nSTAT cmd_other_outlier_count 0\r\nSTAT cmd_other_outlier_all_count 0\r\nSTAT cmd_cas 0\r\nSTAT cmd_delete 0\r\nSTAT cmd_get 13958.8\r\nSTAT cmd_gets 0\r\nSTAT cmd_set 49.0625\r\nSTAT cmd_cas_outlier 0\r\nSTAT cmd_cas_outlier_all 0\r\nSTAT cmd_delete_outlier 0\r\nSTAT cmd_delete_outlier_all 0\r\nSTAT cmd_get_outlier 0\r\nSTAT cmd_get_outlier_all 0\r\nSTAT cmd_gets_outlier 0\r\nSTAT cmd_gets_outlier_all 0\r\nSTAT cmd_set_outlier 0\r\nSTAT cmd_set_outlier_all 0\r\nSTAT cmd_other_outlier 0\r\nSTAT cmd_other_outlier_all 0\r\nSTAT cmd_add_count 0\r\nSTAT cmd_decr_count 0\r\nSTAT cmd_incr_count 0\r\nSTAT cmd_lease_get_count 0\r\nSTAT cmd_lease_set_count 0\r\nSTAT cmd_meta_count 0\r\nSTAT cmd_other_count 0\r\nSTAT cmd_replace_count 0\r\nSTAT cmd_stats_count 16\r\nSTAT redirected_lease_set_count 0\r\nSTAT cmd_add 0\r\nSTAT cmd_decr 0\r\nSTAT cmd_incr 0\r\nSTAT cmd_lease_get 0\r\nSTAT cmd_lease_set 0\r\nSTAT cmd_meta 0\r\nSTAT cmd_other 0\r\nSTAT cmd_replace 0\r\nSTAT cmd_stats 0\r\nSTAT replies_compressed 0\r\nSTAT replies_not_compressed 0\r\nSTAT reply_traffic_before_compression 0\r\nSTAT reply_traffic_after_compression 0\r\nSTAT cmd_cas_out_count 0\r\nSTAT cmd_cas_out_all_count 0\r\nSTAT cmd_delete_out_count 0\r\nSTAT cmd_delete_out_all_count 0\r\nSTAT cmd_get_out_count 185195811\r\nSTAT cmd_get_out_all_count 185195811\r\nSTAT cmd_gets_out_count 0\r\nSTAT cmd_gets_out_all_count 0\r\nSTAT cmd_set_out_count 761411\r\nSTAT cmd_set_out_all_count 761411\r\nSTAT cmd_add_out_count 0\r\nSTAT cmd_add_out_all_count 0\r\nSTAT cmd_decr_out_count 0\r\nSTAT cmd_decr_out_all_count 0\r\nSTAT cmd_incr_out_count 0\r\nSTAT cmd_incr_out_all_count 0\r\nSTAT cmd_lease_get_out_count 0\r\nSTAT cmd_lease_get_out_all_count 0\r\nSTAT cmd_lease_set_out_count 0\r\nSTAT cmd_lease_set_out_all_count 0\r\nSTAT cmd_meta_out_count 0\r\nSTAT cmd_meta_out_all_count 0\r\nSTAT cmd_other_out_count 0\r\nSTAT cmd_other_out_all_count 0\r\nSTAT cmd_replace_out_count 0\r\nSTAT cmd_replace_out_all_count 0\r\nSTAT cmd_cas_out 0\r\nSTAT cmd_cas_out_all 0\r\nSTAT cmd_delete_out 0\r\nSTAT cmd_delete_out_all 0\r\nSTAT cmd_get_out 13958.8\r\nSTAT cmd_get_out_all 13958.8\r\nSTAT cmd_gets_out 0\r\nSTAT cmd_gets_out_all 0\r\nSTAT cmd_set_out 49.0625\r\nSTAT cmd_set_out_all 49.0625\r\nSTAT cmd_add_out 0\r\nSTAT cmd_add_out_all 0\r\nSTAT cmd_decr_out 0\r\nSTAT cmd_decr_out_all 0\r\nSTAT cmd_incr_out 0\r\nSTAT cmd_incr_out_all 0\r\nSTAT cmd_lease_get_out 0\r\nSTAT cmd_lease_get_out_all 0\r\nSTAT cmd_lease_set_out 0\r\nSTAT cmd_lease_set_out_all 0\r\nSTAT cmd_meta_out 0\r\nSTAT cmd_meta_out_all 0\r\nSTAT cmd_other_out 0\r\nSTAT cmd_other_out_all 0\r\nSTAT cmd_replace_out 0\r\nSTAT cmd_replace_out_all 0\r\nSTAT config_age 16149\r\nSTAT config_last_attempt 1482118631\r\nSTAT config_last_success 1482118631\r\nSTAT config_failures 0\r\nSTAT start_time 1482118631\r\nSTAT dev_null_requests 0\r\nSTAT proxy_request_num_outstanding 17\r\nSTAT retrans_per_kbyte_avg 0\r\nSTAT retrans_per_kbyte_max 0\r\nSTAT request_sent_count 185957253\r\nSTAT request_error_count 2\r\nSTAT request_success_count 185957235\r\nSTAT request_replied_count 185957237\r\nSTAT request_sent 14007.9\r\nSTAT request_error 0\r\nSTAT request_success 14007.9\r\nSTAT request_replied 14007.9\r\nSTAT client_queue_notifications 0\r\nSTAT failover_all 0\r\nSTAT failover_all_failed 0\r\nSTAT failover_rate_limited 0\r\nSTAT result_error_count 0\r\nSTAT result_error_all_count 0\r\nSTAT result_connect_error_count 0\r\nSTAT result_connect_error_all_count 0\r\nSTAT result_connect_timeout_count 0\r\nSTAT result_connect_timeout_all_count 0\r\nSTAT result_data_timeout_count 0\r\nSTAT result_data_timeout_all_count 0\r\nSTAT result_busy_count 0\r\nSTAT result_busy_all_count 0\r\nSTAT result_tko_count 0\r\nSTAT result_tko_all_count 0\r\nSTAT result_local_error_count 0\r\nSTAT result_local_error_all_count 0\r\nSTAT result_error 0\r\nSTAT result_error_all 0\r\nSTAT result_connect_error 0\r\nSTAT result_connect_error_all 0\r\nSTAT result_connect_timeout 0\r\nSTAT result_connect_timeout_all 0\r\nSTAT result_data_timeout 0\r\nSTAT result_data_timeout_all 0\r\nSTAT result_busy 0\r\nSTAT result_busy_all 0\r\nSTAT result_tko 0\r\nSTAT result_tko_all 0\r\nSTAT result_local_error 0\r\nSTAT result_local_error_all 0\r\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/169/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "srcspider": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/167", "title": "Install size is heavily BLOATED", "body": "Before I go on let me just clarify where this is very serious issue: Docker containers. Anywhere else the \"disk space is cheap\" argument applies, *probably*.\r\n\r\nIf you install/compile in a Docker container (and you have to at the moment, since there's no prepackaged version), then you will end up with **mcrouter layer in docker of 2.339 GB** !! A bit of cleanup later (removing git repo, yum clean all, etc) and you go down to 1.358 GB (I'm gonna guess there's just a lot of packages that get pulled in as deps).\r\n\r\n1.35 GB is still in the realm of nonsensical, since this has to get pushed and pulled everywhere the docker is required (resulting in considerable downtime, slowdown, etc etc). Consider that the centos:7 image is only 200 MB.\r\n\r\nFrom debugging by installing to a \"mcrouter-install\" prefix I've noticed the the source of the disk usage to be (mainly) the following,\r\n\r\n778M\t/build/mcrouter-install/pkgs\r\n175M\t/build/mcrouter-install/install/lib\r\n\r\nAll these seem to be build artifacts. The lib directory there gets its sized from `.a` and `.so` files for folly and others. But I assume mcrouter is statically linked and doesn't care for any of them? I'm basing this on how the mcrouter binary is 125M itself, which seems a bit bloated to be honest.\r\n\r\nPlease either optimize the install scripts or make a new install script that's specifically designed to produce the smallest result size (cleanup after itself, no install of folly libs that were only used for building, etc).\r\n\r\n_Finally, for the sake of fixing it in the meantime, can I have some clarification on this if possible:_\r\n1. is there a way to make mcrouter compile to be smaller using the install scripts? Even if it's linked to folly it can't possibly use that much of folly--it's like it's starting it's own operating system to run.\r\n2. is it safe to only keep /build/mcrouter-install/install/bin/mcrouter & mcpiper ? I'm only uncertain if you make use of the `.so` files in some strange hacky way\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/167/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "panchenji": {"issues": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/160", "title": "Errors when building release-33-0 on Ubuntu 12.04", "body": "I tried to run command as follows to build:\r\nbash scripts/install_ubuntu_12.04.sh /home/test/tool/mcrouter/mcrouter/build/ -j4\r\n\r\nThe first error I got is for add_compile_options in cmake which supports since 2.8.12 but when building wangle, the requires version in CMakeList is only 2.8. And the default version in ubuntu 12.04 is 2.8.7. I upgraded it to 2.8.12 and fix the issue.\r\n\r\nThe second error I got is related to the compile:\r\n_routes/RateLimiter.cpp: In constructor \u2018facebook::memcache::mcrouter::RateLimiter::RateLimiter(const folly::dynamic&)\u2019:\r\nroutes/RateLimiter.cpp:50:50: internal compiler error: in nothrow_spec_p, at cp/except.c:1272\r\n   auto now = folly::TokenBucket::defaultClockNow();\r\n                                                  ^\r\nPlease submit a full bug report,\r\nwith preprocessed source if appropriate.\r\nSee <file:///usr/share/doc/gcc-4.8/README.Bugs> for instructions.\r\nmv -f routes/.deps/libmcroutercore_a-RandomRoute.Tpo routes/.deps/libmcroutercore_a-RandomRoute.Po\r\ng++ -DHAVE_CONFIG_H   -I.. -I/home/test/tool/mcrouter/mcrouter/build/install/include   -DLIBMC_FBTRACE_DISABLE  -Wno-missing-field-initializers -Wno-deprecated -W -Wall -Wextra -Wno-unused-parameter -fno-strict-aliasing -g -O2 -std=gnu++1y -MT routes/libmcroutercore_a-RouteHandleMap.o -MD -MP -MF rout\r\nIn file included from /home/test/tool/mcrouter/mcrouter/build/install/include/folly/Bits.h:71:0,\r\n                 from /home/test/tool/mcrouter/mcrouter/build/install/include/folly/Hash.h:27,\r\n                 from /home/test/tool/mcrouter/mcrouter/build/install/include/folly/FBString.h:54,\r\n                 from /home/test/tool/mcrouter/mcrouter/build/install/include/folly/Range.h:22,\r\n                 from ../mcrouter/lib/carbon/RequestReplyUtil.h:15,\r\n                 from ../mcrouter/lib/network/gen/Memcache.h:18,\r\n                 from ../mcrouter/lib/Reply.h:16,\r\n                 from routes/RateLimitRoute.h:15,\r\n                 from routes/RateLimitRoute.cpp:10:\r\n../mcrouter/routes/RateLimiter.h: In instantiation of \u2018bool facebook::memcache::mcrouter::RateLimiter::canPassThrough(facebook::memcache::UpdateLikeT<Request>) [with Request = facebook::memcache::McPrependRequest; facebook::memcache::UpdateLikeT<Request> = void*]\u2019:\r\nroutes/RateLimitRoute.h:51:9:   required from \u2018facebook::memcache::ReplyT<Request> facebook::memcache::mcrouter::RateLimitRoute::route(const Request&) [with Request = facebook::memcache::McPrependRequest; facebook::memcache::ReplyT<Request> = facebook::memcache::McPrependReply]\u2019\r\n../mcrouter/lib/RouteHandleIf.h:69:34:   required from \u2018facebook::memcache::ReplyT<Request> facebook::memcache::RouteHandle<Route, RouteHandleIf, carbon::List<Request, Requests ...> >::route(const Request&) [with Route = facebook::memcache::mcrouter::RateLimitRoute; RouteHandleIf = facebook::memcache::mcro\r\nroutes/RateLimitRoute.cpp:37:3:   required from here\r\n../mcrouter/routes/RateLimiter.h:57:65: internal compiler error: in nothrow_spec_p, at cp/except.c:1272\r\n       setsTb_->consume(1.0, folly::TokenBucket::defaultClockNow()));\r\n                                                                 ^\r\n/home/test/tool/mcrouter/mcrouter/build/install/include/folly/Likely.h:30:40: note: in definition of macro \u2018LIKELY\u2019\r\n #define LIKELY(x)   (__builtin_expect((x), 1))\r\n                                        ^\r\nPlease submit a full bug report,\r\nwith preprocessed source if appropriate.\r\nSee <file:///usr/share/doc/gcc-4.8/README.Bugs> for instructions.\r\nPreprocessed source stored into /tmp/cci9SOtZ.out file, please attach this to your bugreport.\r\nERROR: Cannot create report: [Errno 17] File exists: '/var/crash/_usr_lib_gcc_x86_64-linux-gnu_4.8_cc1plus.11636.crash'\r\nmake[2]: *** [routes/libmcroutercore_a-RateLimiter.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\nPreprocessed source stored into /tmp/ccNYCMVv.out file, please attach this to your bugreport.\r\nERROR: Cannot create report: [Errno 17] File exists: '/var/crash/_usr_lib_gcc_x86_64-linux-gnu_4.8_cc1plus.11636.crash'_\r\n\r\n\r\nDid anyone meet this problem before?\r\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/160/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "vrishal": {"issues": [], "commits": [{"url": "https://api.github.com/repos/facebook/mcrouter/commits/7cafcdbdf6a0459d6ffd2ecc5ead5d72e4d510aa", "message": "Add failover policy specific stat counters\n\nSummary: Add failover policy specific stats counters, one for incrementing when failover occurs and another for incrementing when all failover destinations have been exhausted. Without these stats, the failover_all and failover_all_failed stats provide aggregated counts across all failover policies.\n\nReviewed By: andreazevedo\n\nDifferential Revision: D6741561\n\nfbshipit-source-id: 4e44a982f7ceae9604fc5563c57007ca2548af03"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "andreazevedo": {"issues": [], "commits": [{"url": "https://api.github.com/repos/facebook/mcrouter/commits/54fa7b48602fc0f44894d2b4358d2881683edbad", "message": "Use in_place constructor for loggers\n\nReviewed By: glamtechie\n\nDifferential Revision: D6713941\n\nfbshipit-source-id: 7f71a12aeed17a8c71ceb518db8a65f78bb49425"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/112d8604f3a7250041db84913a76134c677f2a12", "message": "Make -n option strictly stop mcpiper after n messages\n\nSummary:\nBefore this diff, the -n option was a best effort option. It would stop after printing >= n messages. For busy servers, this number could but much bigger than n.\nNow, -n option makes sure mcpiper stops after printing exactly n messages.\n\nReviewed By: glamtechie\n\nDifferential Revision: D6543536\n\nfbshipit-source-id: 21ecb5d248edd46aa0960e2a2de6951639ae59d9"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/883db250bd92dc93060682d460cd60f88818bd49", "message": "Fix standalone mcrouter crashes when invalid arguments were given\n\nSummary:\nStandalone mcrouter was coredumping everytime we ran unit tests. The reason\nis that we have a few unit tests that gives invalid arguments to mcrouter and\nexpects it to shutdown.\nThe problem is that instead of shutting down gracefully we were crashing.\nThis diff fixes two separate issues:\n - Crash when an invalid \"carbon_router_name\" was provided.\n - Crash when an invalid config file was provided.\n\nReviewed By: glamtechie\n\nDifferential Revision: D6527582\n\nfbshipit-source-id: f8316225e12c783b02ee303c0325d328ae399b5f"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/83c88eb80b21c857690d03f5cdaf59e4a79c5829", "message": "Light cleanup of ProxyRoute and ServiceInfo\n\nSummary: Change proxy from pointer to reference in ProxyRoute and ServiceInfo.\n\nReviewed By: jmswen\n\nDifferential Revision: D6467376\n\nfbshipit-source-id: ee16d0c242fd5a97d842a6f47ffda29e67111377"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/dfd3591a113637a82fda441c46e8f63b16ca442d", "message": "Add final_result_error stat\n\nSummary: Sometimes (specially when there are ErrorRoutes in the config) it's useful to know how many errors were actually visible to the client.\n\nReviewed By: jmswen\n\nDifferential Revision: D6449848\n\nfbshipit-source-id: 6eb85436b6f6b309cf11ccbb548cb70dc951c749"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/615bf6ecce9fb3349d0e4ec42c8a56bc7755acb0", "message": "Allow service info commands for every router\n\nSummary:\nEnable \"get __mcrouter__....\" commands for all RouterInfos.\nThe behavior is pretty much identical, except that we are not bumping the number of get commands anymore for service info requests.\n\nReviewed By: brianwatling\n\nDifferential Revision: D6400236\n\nfbshipit-source-id: ca6ab20179004f8e98a44dba99fc2535aae3c4c0"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/b92195c98a7bbc015588f71676b9dd6d9d5e6db1", "message": "Add default ssl cert/key\n\nSummary: Use default SSL cert/key if none is provided.\n\nReviewed By: brianwatling\n\nDifferential Revision: D6304419\n\nfbshipit-source-id: f0c5582ed7519586ee0cf85be08feaf683d1ad14"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "felixhandte": {"issues": [], "commits": [{"url": "https://api.github.com/repos/facebook/mcrouter/commits/6654eba55f310eb37f923460e017be674df7e578", "message": "Integrate Managed Compression\n\nSummary:\nInitial integration of Managed Compression into cache client.\n\nDepends on D6630314.\n\n(Note: this ignores all push blocking failures!)\n\nDifferential Revision: D6239431\n\nfbshipit-source-id: 246dee5a78b8f73eefe24b4390b1dcb3c13aa90b"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "yfeldblum": {"issues": [], "commits": [{"url": "https://api.github.com/repos/facebook/mcrouter/commits/a732a6623a1a03bc637cac9abb25f4a887762232", "message": "Kill FOLLY_ALIGNED etc\n\nSummary:\n[Folly] Kill `FOLLY_ALIGNED` etc.\n\n`alignas` is standardized as of C++11. Let us just use that.\n\nReplace:\n* `FOLLY_ALIGNED` with `alignas`\n* `FOLLY_ALIGNED_MAX` with `alignas(folly::max_align_v)`\n* `FOLLY_ALIGN_TO_AVOID_FALSE_SHARING` with `alignas(folly::hardware_destructive_interference_size)`\n\nBecause where `alignas` may be placed is more restrictive than where attributes may be placed, we also need to move these directives in some cases on top of doing the replacement.\n\nReviewed By: Orvid\n\nDifferential Revision: D6555167\n\nfbshipit-source-id: 4b05b570bace3f8c0fe810b6dd58781dd45757f4"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/ec1db83d2cf65ec11bce1e67ab5e56500ed1cb6f", "message": "Move folly/Bits.h to folly/lang/\n\nSummary: [Folly] Move `folly/Bits.h` to `folly/lang/`.\n\nReviewed By: phoad, Orvid\n\nDifferential Revision: D6495547\n\nfbshipit-source-id: a93159321df8277f8a4b4f10a5e4e0fc58cb6022"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/65249fc54f28e1f869810e696166140c655dd092", "message": "Move folly/Baton.h to folly/synchronization/\n\nSummary: [Folly] Move `folly/Baton.h` to `folly/synchronization/`.\n\nReviewed By: phoad, Orvid\n\nDifferential Revision: D6490282\n\nfbshipit-source-id: 66e2d25ffe3275d576b97b81c1987709000f6649"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "orishu": {"issues": [], "commits": [{"url": "https://api.github.com/repos/facebook/mcrouter/commits/c0026b5affed70b995b708258418cb232d11960a", "message": "Added optional \"seed\" argument to @shuffle.\n\nSummary:\nChanges in \"shuffle\":\n1. Can no longer be used with non-array objects. There are no current use cases in configerator/raw_configs\n2. Optional \"seed\" argument. Non-negative integer to be used as random seed.\n\nReviewed By: andreazevedo\n\nDifferential Revision: D6526424\n\nfbshipit-source-id: 653910ac5aa1c618029fe8c73caf3cc7e5971230"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "glamtechie": {"issues": [], "commits": [{"url": "https://api.github.com/repos/facebook/mcrouter/commits/ec8336559ab148980d28712632098409c4ef8cca", "message": "Use LoadBalancerRoute with other routers\n\nReviewed By: andreazevedo\n\nDifferential Revision: D6536158\n\nfbshipit-source-id: 7c52fe243668e767a7415aec3cc95e99c381c7fe"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/c1c8eb8bfe8d7422bff5621a6bd178953efa4fcd", "message": "Remove warnings from ShardSelectionRouteFactory\n\nSummary: I dont think these warnings are useful/actionable.\n\nDifferential Revision: D6467893\n\nfbshipit-source-id: 16dfacabafe6aaddb11d999fde2261a8cb599cde"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "ngoyal": {"issues": [], "commits": [{"url": "https://api.github.com/repos/facebook/mcrouter/commits/4bbe1080a202adab5b277425481542a3b483e938", "message": "reload certs on CA change\n\nSummary:\nThrift servers should reload SSL configuration if cert, key, or CA path change.  TLSCredProcessor had some deficiencies in that it tracked only a single file to trigger the callback.  This augments that class.\n\nAdditionally we remove the watchCertForChanges method on ThriftServer and set up watching when a config is set.\n\nReviewed By: mingtaoy\n\nDifferential Revision: D6501821\n\nfbshipit-source-id: fb4f723af644361b3a87354ca124cace94ad04dc"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "jmswen": {"issues": [], "commits": [{"url": "https://api.github.com/repos/facebook/mcrouter/commits/977bbf170d6296a9b392f3998f403337521f9b7e", "message": "Integrate extstore into memcached\n\nReviewed By: brianwatling\n\nDifferential Revision: D6378357\n\nfbshipit-source-id: 2801bb5ae773059a83d46482e20d12cfbf975cc0"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/a702aea9348bdb92c43e2d4f668d4ad3f740c605", "message": "Add SSL-related stats\n\nSummary:\nAdd client-side SSL stats for current number of open SSL connections to remote\nservers, total number of opened SSL connections over mcrouter instance lifetime,\ntotal number of attempts to resume SSL sessions, and total number of resumption\nsuccesses.\n\nReviewed By: andreazevedo\n\nDifferential Revision: D6449459\n\nfbshipit-source-id: b54da02071b4827713337984e70c7e453fc07fb6"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/9c55dfff03495b3ee05aa1b342dc8399d03b3748", "message": "Add stat for current number of open SSL connections\n\nSummary:\nSeparating this stat out from D6449459 to make review easier, since there's now\nsome light refactoring of `ProxyDestination` involved.\n\nIn order to maintain current number of open SSL connections\n(`num_ssl_servers_up`), it is easier in terms of maintaining correctness of the\nstat to integrate with the existing state transition logic in `ProxyDestination`.\n\nReviewed By: andreazevedo\n\nDifferential Revision: D6457064\n\nfbshipit-source-id: 7e76a640a4fe7fa54b40b6c63b6648c01dcdba38"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/5eaa6c48c67d5410ee1b36cf93fcd9b806a4816d", "message": "Light cleanup of ProxyDestination\n\nSummary:\nA couple easy cleanup items in this diff for `ProxyDestination`:\n* Change `proxy` member of `ProxyDestination` from pointer to reference\n* Forward declare in `ProxyDestination.h` and/or move includes to `.cpp` where\n  possible.\n\nReviewed By: andreazevedo\n\nDifferential Revision: D6457065\n\nfbshipit-source-id: f01c0f07024c9f0628336b7a40ec7e15470802ce"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/1cb56514d422cd01b6c1dec579a0098a9ced1125", "message": "Mark a couple members of ProxyDestination as const\n\nSummary:\nTitle. In particular, makes it trivial to reason that `accessPoint_` pointer is\nnever modified after construction.\n\nReviewed By: andreazevedo\n\nDifferential Revision: D6453780\n\nfbshipit-source-id: 730433cd4b9bb17bfa1aabbc4c6d0a9e345c88a8"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/8d92550a2c9153d111f9bb8c0713aaf83e0afb0f", "message": "More integration tests for L1L2SizeSplitRouteHandle\n\nSummary:\nAdd integration tests for `L1L2SizeSplitRouteHandle` for lease operations.\n\nPlanning to add a couple more tests tomorrow morning.\n\nReviewed By: andreazevedo\n\nDifferential Revision: D6245348\n\nfbshipit-source-id: ad5c510ddac503e7152118d98f7f5054d4a4f168"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/5a0ddb92a9eff0b21868458632d3796974033cc5", "message": "Run integration tests against memcached\n\nSummary: Run mcrouter integration tests against production memcached.\n\nReviewed By: dormando\n\nDifferential Revision: D6243705\n\nfbshipit-source-id: 247f61e7c99acf3550d4986a750ad2394e7e55c1"}, {"url": "https://api.github.com/repos/facebook/mcrouter/commits/6432c25ab33df1f7acbe4c8e67b9baa7574275aa", "message": "L1L2SizeSplit lease support\n\nSummary:\nAdd support for lease operations in `L1L2SizeSplitRoute`.  Here's the basic idea of how `L1L2SizeSplitRoute` works for `get`, `set`, `lease-get`, and `lease-set` operations.\n\n`get`\n* Read from L1.  Clients must opt into L1/L2 behavior by supplying the `MC_MSG_FLAG_SIZE_SPLIT` flag in the `McGetRequest`.  A server-side change will be required to check for this flag.  (This is in order to support old clients.)\n* Only special case is when L1 returns a sentinel value.  In this case, client sends a subsequent `get` request to L2.\n\n`set`\nTwo options are supported: `bothFullSet` and not `bothFullSet`.\n* With `bothFullSet`, client sends an `McSetRequest` to each of L1 and L2.  (No special augmentation of key, value, etc. for plain `set` requests.)\n* If `bothFullSet` is turned off, client sends the `McSetRequest` to L2.  If successful, a sentinel is set in L1.  The sentinel request has the ordinary key, empty value, and comes with the special `MC_MSG_FLAG_SIZE_SPLIT` flag.\n\n`lease-get`\nMain interesting case is when L1 gives a hit on a sentinel value (which has value `<rand>`).  In this case:\n* Send `get key|==|<rand>` to L2.  If it's a hit, return the hit to the client.\n* Otherwise, if L2 returned an error **or** if we're out of retries, return an error.\n* Otherwise, invalidate the key in L1 via gets/cas and retry the entire operation.\n* Side note: stale hits on L1 are converted to misses with token/hot misses.\n\n`lease-set`\n* If `bothFullSet` is enabled, send full `lease-set` of data but first adjusting key to `key|==|<rand>`.  If successfully stored in L1, do a plain set of the same data (with same adjusted key) to L2.\n* If `bothFullSet` is disabled, before the sentinel to L1 is committed, set `key|==|<rand>` and the full data to L2.  If set to L2 is successful, set the sentinel value in L1 (regular, unaugmented key + value `<rand>`).\n\nReviewed By: andreazevedo\n\nDifferential Revision: D6109236\n\nfbshipit-source-id: 741a672d09f21c44b9274fbf1a98fdf3a0d8cca5"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "Orvid": {"issues": [], "commits": [{"url": "https://api.github.com/repos/facebook/mcrouter/commits/e5247fcab8b73e16a8633f1d9ad1c687cd5649f4", "message": "Fix OSS build\n\nSummary: `checkLogic` was defined in `lib/fbi/cpp/util.h` but wasn't ending up being included in the OSS build.\n\nReviewed By: jmswen\n\nDifferential Revision: D6479015\n\nfbshipit-source-id: b268145516cd20710ef308d10cb813a2ba65b3b4"}], "pull_requests": [], "issue_comments": [], "commit_comments": [], "review_comments": []}, "flarnie": {"issues": [], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/facebook/mcrouter/pulls/226", "title": "Add `CONTRIBUTING.md` and `CODE_OF_CONDUCT.md`", "body": "In the past there was not info and support to add these docs to all Facebook Open Source projects. It's a useful measure that we can take now to create a healthy, welcoming open source community. :)\r\n\r\n**why make this change?:**\r\nFacebook Open Source provides a Code of Conduct statement for all\r\nprojects to follow, to promote a welcoming and safe open source community.\r\n\r\nExposing the COC via a separate markdown file is a standard being\r\npromoted by Github via the Community Profile in order to meet their Open\r\nSource Guide's recommended community standards.\r\n\r\nAs you can see, adding this file will improve [the Mcrouter community profile](https://github.com/facebook/mcrouter/community)\r\nchecklist and increase the visibility of our COC.\r\n\r\n**test plan:**\r\nViewing it on my branch - \r\n<img width=\"1201\" alt=\"screen shot 2017-12-05 at 6 23 01 am\" src=\"https://user-images.githubusercontent.com/1114467/33611918-d6a43a26-d984-11e7-9bf8-8515d71b0158.png\">\r\n<img width=\"1208\" alt=\"screen shot 2017-12-05 at 6 23 19 am\" src=\"https://user-images.githubusercontent.com/1114467/33611920-d7dc2ae8-d984-11e7-9874-539dbb1b0add.png\">\r\n\r\n**issue:**\r\ninternal task t23481323", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "Ngo-The-Trung": {"issues": [], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/facebook/mcrouter/pulls/207", "title": "(Work in progress) Support binary protocol", "body": "An attempt at fixing https://github.com/facebook/mcrouter/issues/6\r\n\r\nForeword: I'm not good at C++ at all. All advices welcomed, especially advices on the approach - I'm not sure if this is the right way to do it at all (for instance, is using reinterpret_cast a proper way to parse network data?). \r\n\r\nTODO:\r\n- [ ] Early stop when encountering invalid opcode\r\n- [ ] Early stop when command violates field constraints (like having an extras field when there shouldn't be any)\r\n- [ ] Return binary responses\r\n- [ ] Support 'quiet' and 'key' variations of the commands.\r\n- [ ] Implements CAS field (not present in ascii protocol)", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "oguzy": {"issues": [], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/facebook/mcrouter/pulls/205", "title": "Missing apt package", "body": "Also added required volumes", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "Stantheman": {"issues": [], "commits": [], "pull_requests": [{"url": "https://api.github.com/repos/facebook/mcrouter/pulls/204", "title": "Fix Dockerfile dependencies for add-apt-repository", "body": "The recipe scripts use the add-apt-repository command, which on Ubuntu 14.04 is provided by the software-properties-common command. Currently, the image fails to build once it hits the installation recipe.", "author_association": "NONE"}], "issue_comments": [], "commit_comments": [], "review_comments": []}, "alikhtarov": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/55945079", "body": "Thanks! This is due to the last line (\"$INSTALL_DIR/bin/mcrouter\" --help), you can simply remove it as a workaround. I will fix this in the trunk as well.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/55945079/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/55961722", "body": "Fixed as of https://github.com/facebook/mcrouter/commit/384134845e7ca5c39268b8ddd2b9d95ddff3aa98\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/55961722/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56214411", "body": "Awesome! We should just add those links to the wiki\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56214411/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56249525", "body": "@tweibley PRs definitely welcome!\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56249525/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57512434", "body": "To add to Pavlo's answer, you should also make sure that the replacement IP address is swapped at the same position in the array.\n\nFor example, say you have \"servers\": [ \"ip1\", \"ip2\", \"ip3\" ] and ip2 breaks down. Then you replace it with ip4 like so: [ \"ip1\", \"ip4\", \"ip3\" ]. This guarantees that all keys that would be sharded to ip2 are now sharded to ip4.\n\nThe actual IP address is not used by mcrouter for hash computation, only its position in the array and the number of hosts in the array.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57512434/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57529528", "body": "Yeah exactly. Makes me think we should emphasize this on the wiki, as it's something that's not obvious but we take for granted since we've used it for a long time now.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57529528/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59430457", "body": "@renchap yes, the Umbrella protocol is something we use internally at Facebook. We don't want to document it in detail, since it probably won't be useful outside of Facebook, and we also want to have flexibility to change the format.\nI like the idea of supporting the open source binary protocol, and it wouldn't be too difficult to implement. It would be ideal if we got a pull request for implementing this :)\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59430457/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59569454", "body": "@swar0g thanks for the report, looking into this.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59569454/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59569552", "body": "@pavlo-fb: this might be related to boost::context compatibility stuff\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59569552/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60017398", "body": "@swar0g That's great! We also fixed this upstream and will update github soon, so it should work with 1.56 as well.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60017398/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60321765", "body": "@0xd3adsh3ll and if you don't find an answer on the wiki, please open an issue here and we'll improve our docs.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60321765/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commit_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/comments/12436522", "body": "@hrjaco This was only a problem in the code that unset the read callback and had outstanding writes that errored out. Normally, a writeErr() callback would be followed by a readEOF() which would also close the connection, unless the read callback happened to be uninstalled at the time.\n\nThis could in theory happen with mcrouter if the server hit the limit of outstanding unreplied requests (maxInFlight) so that it would pause the connection and happened to receive a writeErr at that time, but we never observed this issue in production. This bugfix was necessary because of another project that shares the same server code internally - that project calls pause() on the connection manually and much more often than mcrouter does.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/comments/12436522/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/comments/12744439", "body": "@samveen This was a one-off sync to fix the open source build, I think some process was not followed so the tag was not created by mistake. We'll fix this for future releases.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/comments/12744439/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": []}, "tweibley": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56042386", "body": "This was due to mismatched boost include files in /usr/local/include. Removed, rebuilt boost and updated includes.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56042386/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56243666", "body": "I had manually compiled and installed the latest version of boost (like 1.5 or 1.6 or whatever). I then thought I completely removed the lib and include files, however the older include files remained even after building and installing the 1.4 or earlier version. I manually removed all of the boost files in the include dir and then ran make install again and everything was happy. Hope that helps!\n\nPS FWIW I was working on getting this to build on Ubuntu 12.04 which I've now done. I'll clean up my branch and send a PR if the facebook people are interested.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56243666/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commit_comments": [], "review_comments": []}, "genx7up": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56200212", "body": "What was the mismatch? What is your Boost version? I am getting the same error with 1.56.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56200212/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commit_comments": [], "review_comments": []}, "facebook-github-bot": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56329493", "body": "Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56329493/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57298147", "body": "Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57298147/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commit_comments": [], "review_comments": []}, "pavlo-fb": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56563339", "body": "@djinn sorry, we can't use your code without you signing a CLA. Please sign it and we'll be able to review your pull request. Thanks!\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/56563339/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57280441", "body": "Hi @jamescarr ,\nThanks for your questions.\n1) One can run mcrouter on each host, so clients will talk to local mcrouter instance. Mcrouter is mostly stateless (except TKO state and some other minor cases), so if it crashes (which shouldn't happen at all), the restart takes seconds and is mostly harmless. If the entire host goes down, we don't care about mcrouter on that box - it was used only by local services.\nIf memcached instance goes down, mcrouter can take care of it using [failover](https://github.com/facebook/mcrouter/wiki/List-of-Route-Handles#failoverroute).\n2) You are right, hash for the same key will be the same. Thus, mcrouter will route to the same server no matter where it runs. Of course, I assume mcrouter config and command line options are the same.\n3) Mcrouter doesn't care about backend IP address or architecture. If you swap a server (i.e. change some IP address in `servers` property of a pool), requests will be sent to the new one the same way they were sent to the old one (I assume you don't change size of pool).\nIf you expand/shrink the pool, only minimal possible number of requests will be rerouted (that's the property of [consistent hashing](http://en.wikipedia.org/wiki/Consistent_hashing)). So, if you have a pool with 9 servers and you add 1 more, only 10% of requests will be rerouted to the new box. If you remove 1 box out of 10, load on other 9 boxes will increase by 11.1% (initially they handled 10% of requests each, after shrink they will handle 11.1% each).\nAnother thing is the new box will, probably, be 'cold' (i.e. it will have no cache at all). Mcrouter can take care of it as well, check [Cold cache warm up](https://github.com/facebook/mcrouter/wiki/Cold-cache-warm-up-setup).\n\nHope that helps. Let me know if you have any further questions.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57280441/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57399073", "body": "- \"ensuring shard computation stays consistent regardless of backends\" - the only thing you should change is host address in config (check [defining pools](https://github.com/facebook/mcrouter/wiki/Configuration#defining-pools), you need to modify `servers` list). Shard computation is based on key hash, so nothing will change if you replace one server with another (and update `servers` in config, of course).\n- Yeah, [ZooKeeper](http://zookeeper.apache.org/) or any analogue sounds like a good way to go. Tip: if you don't want to distribute the whole config when only one pool has changed (e.g. replace a server, like in previous question), you can split your config into multiple files (e.g. one file per pool). See [@import](https://github.com/facebook/mcrouter/wiki/JSONM#import).\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57399073/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59996466", "body": "In this config sets and deletes are routed via `AllSyncRoute`. It sends a request to all servers in the pool and returns the worst reply, i.e. an error if some occurred. So, if some server is down, mcrouter will return \"SERVER_ERROR\", because it can not set a value to this server. Your get requests will still work - `LatestRoute` will failover a request silently.\nIf you don't want to get any errors on failed sets, use `AllAsyncRoute` instead of `AllSyncRoute`. It will return \"NOT_STORED\" immediately without even waiting for replies from servers.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59996466/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60110609", "body": "Hi,\nAs I understand, you do not disable `memcached1` while sending GET requests?\nIf the first server was available and didn't return an error reply, `FailoverRoute` will _not_ send the request to second server. That's why you see all 1000 requests processed by `memcached1`. `FailoverRoute` will send to `memcached2` _only_ when it receives an error reply (miss counts for success) from `memcached1`.\nIf you want to send a request to `memcached2` on misses (i.e. when key is not found on `memcached1`), use [MissFailoverRoute](https://github.com/facebook/mcrouter/wiki/List-of-Route-Handles#missfailoverroute) instead of `FailoverRoute`.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60110609/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60283883", "body": "Hi Maxim,\nYes, [mcrouter wiki](https://github.com/facebook/mcrouter/wiki) is the most comprehensive and up to date documentation for mcrouter.\nThanks for your feedback!\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60283883/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commit_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/comments/21122556", "body": "OMG, it happened!\r\n![clap](https://cloud.githubusercontent.com/assets/7834475/23511892/69c4ac26-ff67-11e6-8ed1-ddb6e63a40b0.gif)\r\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/comments/21122556/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 1, "hooray": 1, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/comments/22324020", "body": "Can you add a unit test, please? It should be pretty easy to do. Just add smth like\r\n```javascript\r\n   \"macros\": {\r\n    \"a\": {\r\n        \"type\": \"macroDef\",\r\n        \"params\": [ { \"name\": \"a\", \"optional\": false, \"default\": 5 } ],\r\n        \"result\": \"%a%\"\r\n      }\r\n    },\r\n    \"ret\": \"@a\"\r\n```\r\nin `config_preprocessor_test_errors.json`. Thanks :)", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/comments/22324020/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}, {"url": "https://api.github.com/repos/facebook/mcrouter/comments/22346589", "body": "![el-88pc-de-los-vendedores-online-utiliza-facebook-para-aumentar-sus-ventas-600x290](https://cloud.githubusercontent.com/assets/7834475/26640326/1a0e4858-4630-11e7-8642-3b2edad8ec1a.jpg)\r\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/comments/22346589/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "review_comments": []}, "djinn": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57290288", "body": "I have signed the CLA. \n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57290288/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "CONTRIBUTOR"}], "commit_comments": [], "review_comments": []}, "jamescarr": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57324973", "body": "Thanks for the reply! A few follow up questions. :-)\n- \"ensuring shard computation stays consistent regardless of backends\" - in our specific case on EC2, it is not uncommon for an instance to go south and we replace it with a new instance that has a different IP. Couldn't this cause some problems?\n- I actually thought about the same approach you mentioned... having each box run mcrouter as a way to interface with cache clusters. At the point the biggest concern is keeping the configuration consistent across clients (we currently have 56 servers that are clients to our cache boxes). I am guessing something like ZK, etcd or consul will come into play here. \n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57324973/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57513580", "body": "Ah that was what I was curious about. So the array index is used for\ncomputing the key.\n\nOn Wed, Oct 1, 2014 at 1:28 PM, alikhtarov notifications@github.com wrote:\n\n> To add to Pavlo's answer, you should also make sure that the replacement\n> IP address is swapped at the same position in the array.\n> \n> For example, say you have \"servers\": [ \"ip1\", \"ip2\", \"ip3\" ] and ip2\n> breaks down. Then you replace it with ip4 like so: [ \"ip1\", \"ip4\", \"ip3\" ].\n> This guarantees that all keys that would be sharded to ip2 are now sharded\n> to ip4.\n> \n> The actual IP address is not used by mcrouter for hash computation, only\n> its position in the array and the number of hosts in the array.\n> \n> \u2014\n> Reply to this email directly or view it on GitHub\n> https://github.com/facebook/mcrouter/issues/5#issuecomment-57512434.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/57513580/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commit_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/comments/7830651", "body": ":+1: I had actually just nuked the line in my branch to get past it but never did a PR :-/\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/comments/7830651/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "review_comments": []}, "0xd3adsh3ll": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59879383", "body": "Oh, sorry. http://pastebin.com/9npbg57D \n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59879383/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60036800", "body": "It's great! Thanks a lot pavlo-fb!\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60036800/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60091334", "body": "SET:\n1. Run java app (set mode) steps from 1 to 1000\n2. Create iptables rules for blocking memcached2 - ok, mcrouter \"set\" to memcached1 - no errors\n3. Delete iptables rules for memcached2 - ok, mcrouter delete \"TKO\" from memcached2 and \"set\" to all nodes - no errors\n4. Create iptables rules for blocking memcached1 - ok, mcrouter \"set\" to memcached2 - no errors\n5. Delete iptables rules for memcached1 - ok, mcrouter delete \"TKO\" from memcached1 and \"set\" to all nodes - no errors\n\nJava app stop, all 1000 requests a set, no errors\n\nGET:\n1. Run java app (get mode) steps from 1 to 1000\n2. Java app connect to mcrouter and do get keys and values from 1 to 1000\n3. Java app stop all 1000 requests and create stats file with info.\n4. I'm viewing log file from memcached1 and see 1000 get requests\n5. I'm viewing log file from memcached2 and don't see any requests. But \"get\" type - FailoverRoute\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60091334/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60210249", "body": "Hello,\nThanks you very much! MissFailoverRoute - very well for me.\npavlo-fb, can you provide for me all documentation about mcrouter? Docs from github is full?\nWe starts high load project and mcrouter is amazing and the best solution for us.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/60210249/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commit_comments": [], "review_comments": []}, "swar0g": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59884555", "body": "@alikhtarov Indeed, you Are Right, that's It. Downgrade to 1.55 solves the pb. Works as expected, even better. Thx for support and for sharing such amazing tool.\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/issues/comments/59884555/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "commit_comments": [], "review_comments": []}, "hrjaco": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/comments/12430423", "body": "Curious what's the impact of not calling close() here? Will Mcrouter leave this connection open, even if its client has closed the connection?\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/comments/12430423/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "review_comments": []}, "samveen": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/comments/12732213", "body": "No associated release/tag?\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/comments/12732213/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "review_comments": []}, "rektide": {"issues": [], "commits": [], "pull_requests": [], "issue_comments": [], "commit_comments": [{"url": "https://api.github.com/repos/facebook/mcrouter/comments/19019462", "body": "Hey, there's two facebook internal links in this commit description. Might those be brought onto the Mcrouter wiki, or otherwise made available?\n[zstd reveal post](https://code.facebook.com/posts/1658392934479273/smaller-and-faster-data-compression-with-zstandard/) probably contains a significant amount of the information in the [first link](https://our.intern.facebook.com/intern/wiki/Benchmarking_ZSTD_and_LZ4_algorithms/), but I'm very very interested in getting access to the [second link](https://our.intern.facebook.com/intern/wiki/Compression_with_specialized_dictionaries/).\n\nThis is one of the first major zstd sightings in the wild! Way cool to see!\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/comments/19019462/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}, {"url": "https://api.github.com/repos/facebook/mcrouter/comments/19024686", "body": "Super interesting change. What drove this change away from using Thrift as interconnect?\n", "reactions": {"url": "https://api.github.com/repos/facebook/mcrouter/comments/19024686/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0}, "author_association": "NONE"}], "review_comments": []}}}}